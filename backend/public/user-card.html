<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Картка спеціаліста</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
  <script>
    function getUserIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("id");
    }
  </script>
  <style>

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
    }

    header {
    background-color: #275D2B;
    height: 80px;
    padding: 16px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .logo {
    width: 156.48px;
    height: 48px;
    object-fit: contain;
    margin-left: 110px;
  }
  
  .language-select {
    color: white;
    font-size: 16px;
    margin-right: 40px;
  }
  
    .profile-container {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .profile-left {
      flex: 0 0 auto;
    }
    .profile-left img {
      width: 100%;
      border-radius: 12px;
    }
    .profile-card {
      width: 100%;
      max-width: 412px;
      height: auto;
      border: 2px solid #E5EAF3;
      border-radius: 20px;
      background-color: white;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .profile-photo {
      width: 100%;
      height: 370px;
      object-fit: cover;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }
    .profile-info {
      padding: 20px;
      text-align: center;
    }
    .profile-info h2 {
      font-size: 20px;
      font-weight: 700;
      margin: 10px 0 6px;
      color: #1B2A41;
    }
    .profile-info .availability {
      font-size: 14px;
      color: #1B2A41;
      margin-bottom: 16px;
    }
    .tags {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tags span {
      border: 1px solid #1B2A41;
      border-radius: 16px;
      padding: 4px 12px;
      font-size: 13px;
      color: #1B2A41;
    }
    .contact-btn {
        width: 388px;
      background-color: #1C5D2F;
      color: white;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .contact-btn:hover {
      background-color: #174d27;
    }
    .profile-right {
      flex: 1;
    }
    .profile-right h3 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
    }
    .info-boxes {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .info-box {
      width: 236px;
      height: 80px;
      border: 2px solid #E37009;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .info-box .big {
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      font-size: 24px;
      color: #1B2A41;
    }
    .info-box .small {
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      font-size: 16px;
      color: #1B2A41;
    }
    .work-list h4 {
  font-family: 'Montserrat', sans-serif;
  font-weight: 600;
  font-size: 24px;
  color: #1B2A41;
  margin-bottom: 16px;
}

.work-list ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.work-list li {
  display: flex;
  align-items: center;
  gap: 12px;
}

.work-list li img {
  width: 24px;
  height: 24px;
}

.work-list li span {
  font-family: 'Montserrat', sans-serif;
  font-weight: 400;
  font-size: 20px;
  color: #1B2A41;
}

    .roles h4 {
  font-family: 'Montserrat', sans-serif;
  font-weight: 600;
  font-size: 24px;
  margin-bottom: 12px;
  color: #1B263A;
}

.role-tags {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.role-tag {
  font-family: 'Montserrat', sans-serif;
  font-weight: 500;
  font-size: 20px;
  color: #1B263A;
  border: 1px solid #1B263A;
  border-radius: 24px;
  padding: 6px 20px;
  display: inline-block;
}

.certificates-section {
  max-width: 1200px;
  margin: 60px auto 40px; /* Больше отступ сверху */
  padding: 0 20px;
  text-align: center;
}


.certificates-section h3 {
  font-family: 'Montserrat', sans-serif;
  font-weight: 600;
  font-size: 32px;
  color: #1B263A;
  text-align: center;
  margin-bottom: 24px;
}

.certificate-buttons {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 36px;
  flex-wrap: wrap; /* теперь можно переносить */
}


.cert-btn {
  font-family: 'Montserrat', sans-serif;
  font-weight: 500;
  font-size: 16px;
  background-color: #275D2B;
  color: white;
  border: none;
  border-radius: 12px;
  width: 372px;
  height: 48px;
  padding: 12px 16px;
  cursor: pointer;
  transition: background-color 0.3s ease, opacity 0.2s ease;
  text-align: center;
}

.cert-btn:hover {
  background-color: #26742c;
}

.cert-btn.active {
  background-color: #2F8B35;
}
.cert-btn:disabled {
  opacity: .6;
  cursor: not-allowed;
}
.cert-list {
  max-width: 1200px;
  margin: 16px auto 40px;
  padding: 0 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
}
.cert-item {
  border: 1px solid #E5EAF3;
  border-radius: 12px;
  background: #fff;
  padding: 16px;
}
.cert-item h5 {
  margin: 0 0 8px;
  font-family: 'Montserrat', sans-serif;
  font-size: 16px;
  color: #1B263A;
}
.cert-item .dates {
  font-size: 14px;
  color: #495057;
  margin-bottom: 10px;
}
.cert-item .actions {
  display: flex;
  gap: 8px;
}
.cert-item .actions a,
.cert-item .actions span {
  display: inline-block;
  padding: 8px 10px;
  border-radius: 8px;
  background: #E5EAF3;
  color: #1B263A;
  font-size: 14px;
  text-decoration: none;
}

.main-experience h4 {
  font-family: 'Montserrat', sans-serif;
  font-weight: 600;
  font-size: 24px;
  color: #1B2A41;
  margin-top: 40px;
  margin-bottom: 12px;
}

#mainExperienceText {
  font-family: 'Montserrat', sans-serif;
  font-size: 20px;
  color: #1B2A41;
  line-height: 1.5;
}


  </style>
</head>
<body>
  <header >
  <a href="https://mamko-prof-supervision.com/" target="_blank" rel="noopener noreferrer">
    <img class="logo" src="./assets/logo.png" alt="Institute Logo" style="height: 40px;" />
  </a>
  <div style="display: flex; align-items: center; gap: 20px;">
    <button onclick="window.history.back()" style="font-family: 'Montserrat', sans-serif; background-color: #E5EAF3; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer;">← До Дому</button>
    <div class="language-select">UA ▼</div>
  </div>
</header>

  <div class="profile-container">
    <div class="profile-left">
      <div class="profile-card">
        <img src="./assets/ava.png" alt="Фото спеціаліста" class="profile-photo" />
        <div class="profile-info">
          <h2>Анна Олександрівна Денисова</h2>
          <p class="availability">Онлайн | Офлайн</p>
          <div class="tags">
            <span>Психолог</span>
            <span>Психоаналітик</span>
            <span>Психотерапевт</span>
          </div>
          <button class="contact-btn">Звернутись</button>
        </div>
      </div>
    </div>
    <div class="profile-right">
      <h3>Загальна інформація</h3>
      <div class="info-boxes">
        <div class="info-box">
          <div class="big">7 років</div>
          <div class="small">досвіду роботи</div>
        </div>
        <div class="info-box">
          <div class="big">Офлайн</div>
          <div class="small">Київ</div>
        </div>
      </div>
     <div class="work-list">
       <h4>Працюю з</h4>
        <ul>
        <li><img src="./assets/checker.png" alt="check" /><span>депресія</span></li>
       <li><img src="./assets/checker.png" alt="check" /><span>тривожні стани</span></li>
        <li><img src="./assets/checker.png" alt="check" /><span>депресивні стани</span></li>
        <li><img src="./assets/checker.png" alt="check" /><span>панічні атаки</span></li>
        <li><img src="./assets/checker.png" alt="check" /><span>адаптація міграції</span></li>
        </ul>
        </div>

  <div class="main-experience">
  <h4>Досвід</h4>
  <p id="mainExperienceText"></p>
</div>


        

        <div class="roles">
        <h4>Роль в компанії</h4>
        <div class="role-tags">
        <span class="role-tag">Ментор</span>
        <span class="role-tag">Супервізор</span>
        </div>
        </div>

      </div> 
      </div><!-- Закрывает .profile-container -->

  <div class="certificates-section">
    <h3>Сертифікати</h3>
    <div class="certificate-buttons" id="certTabs">
      <button class="cert-btn active" data-main-type="Підвищення кваліфікації">Підвищення кваліфікації</button>
      <button class="cert-btn" data-main-type="Курс">Проходження курсів</button>
      <button class="cert-btn" data-main-type="Конференція">Проходження конференцій</button>
      <button class="cert-btn" data-main-type="Група">Групи</button>
    </div>
    <div id="certList" class="cert-list"></div>
  </div>
  <script>
async function loadUserData() {
  const userId = getUserIdFromUrl();
  if (!userId) return alert("ID не задано");

  try {
   const res = await fetch(`/api/users/${userId}`);
    const user = await res.json();

    // Имя
    document.querySelector("h2").textContent = `${user.firstName || ""} ${user.middleName || ""} ${user.lastName || ""}`;

    // Фото
    if (user.photoUrl) {
      document.querySelector(".profile-photo").src = user.photoUrl;
    }

    // Формат (Онлайн / Офлайн)
    document.querySelector(".availability").textContent = user.format || "Формат не вказано";

    // Направления
    const tags = document.querySelector(".tags");
    tags.innerHTML = "";
    if (Array.isArray(user.directions)) {
      user.directions.forEach(tag => {
        const span = document.createElement("span");
        span.textContent = tag;
        tags.appendChild(span);
      });
    }


       // Опыт и Город
    const infoBoxes = document.querySelectorAll(".info-boxes .info-box");

    if (infoBoxes.length > 0) {
      infoBoxes[0].querySelector(".big").textContent = user.experience || "?";
      infoBoxes[0].querySelector(".small").textContent = "досвіду роботи";
    }

    if (infoBoxes.length > 1) {
      infoBoxes[1].querySelector(".big").textContent = user.format || "—";
      infoBoxes[1].querySelector(".small").textContent = user.city || "Місто не вказано";
    }

    // Основний досвід
    const mainExperienceText = document.getElementById("mainExperienceText");
    mainExperienceText.textContent = user.experience || "—";


    // Темы (topics)
    const workList = document.querySelector(".work-list ul");
    workList.innerHTML = "";
    if (Array.isArray(user.topics)) {
      user.topics.forEach(topic => {
        const li = document.createElement("li");
        li.innerHTML = `<img src="./assets/checker.png" alt="check" /><span>${topic}</span>`;
        workList.appendChild(li);
      });
    }

    // Роли
    const roleTags = document.querySelector(".role-tags");
    roleTags.innerHTML = "";
    if (user.role) {
      user.role.split(",").forEach(role => {
        const span = document.createElement("span");
        span.className = "role-tag";
        span.textContent = role.trim();
        roleTags.appendChild(span);
      });
    }

    await buildCertificatesView(user);

  } catch (error) {
    console.error("Помилка при завантаженні користувача:", error);
    alert("Помилка при завантаженні даних.");
  }
}

document.addEventListener("DOMContentLoaded", loadUserData);

const API_BASE_PUBLIC = ""; // same origin

function fmtRange(d1, d2){
  const a = d1 ? new Date(d1) : null, b = d2 ? new Date(d2) : null;
  const s = a && !isNaN(a) ? a.toLocaleDateString('uk-UA') : '';
  const e = b && !isNaN(b) ? b.toLocaleDateString('uk-UA') : '';
  return s && e ? `${s} – ${e}` : (s || e || '');
}

async function buildCertificatesView(user){
  // 1) Собираем ID курсов из user.certificates
  const certMap = user?.certificates || {};
  const courseIds = Object.keys(certMap);
  if (!courseIds.length){
    document.getElementById('certList').innerHTML = '<p>Поки що немає доданих сертифікатів.</p>';
    return;
  }

  // 2) Тянем все курсы и оставляем только наши
  // (если появится API по ids — заменить на него)
  const res = await fetch(`/api/courses`);
  const allCourses = await res.json();
  const myCourses = allCourses.filter(c => courseIds.includes(String(c._id)));

  // 3) Группируем по mainType
  const byType = myCourses.reduce((acc, c) => {
    const key = c.mainType || c.eventType || 'Інше';
    acc[key] = acc[key] || [];
    acc[key].push(c);
    return acc;
  }, {});

  // 4) Вкладки
  const tabs = document.getElementById('certTabs');
  const list = document.getElementById('certList');

  function renderType(type){
    // активная кнопка
    tabs.querySelectorAll('.cert-btn').forEach(b=>{
      b.classList.toggle('active', b.dataset.mainType === type);
    });
    // элементы
    const curr = (byType[type] || []).filter(c => c.status === 'Пройдений');
    if (!curr.length){
      list.innerHTML = '<p>Немає сертифікатів у цій категорії.</p>';
      return;
    }
    list.innerHTML = curr.map(course=>{
      const cert = certMap[course._id] || certMap[String(course._id)] || {};
      const ua = cert.ua?.url || '';
      const eng = (cert.eng?.url || cert.en?.url || '');

      return `
        <div class="cert-item">
          <h5>${course.courseTitle || 'Без назви'}</h5>
          <div class="dates">${fmtRange(course.courseDates?.start, course.courseDates?.end)}</div>
          <div class="actions">
            ${ua ? `<a href="${ua}" target="_blank">UA</a>` : `<span>UA недоступний</span>`}
            ${eng ? `<a href="${eng}" target="_blank">EN</a>` : `<span>EN недоступний</span>`}
          </div>
        </div>
      `;
    }).join('');
  }

  // обработчики вкладок
  tabs.addEventListener('click', (e)=>{
    const btn = e.target.closest('.cert-btn');
    if (!btn) return;
    renderType(btn.dataset.mainType);
  });

  // первичный рендер (оставляем активную из разметки)
  const initial = tabs.querySelector('.cert-btn.active')?.dataset.mainType || 'Підвищення кваліфікації';
  renderType(initial);
}
</script>

</body>

  
</body>
</html>
