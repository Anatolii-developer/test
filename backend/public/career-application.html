<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Подати заявку</title>
  <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background-color: #97c194;
        color: #414141;
        padding: 0;
      }

      main.apply-page {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 32px 16px 72px;
        box-sizing: border-box;
      }

      .apply-header {
        width: 100%;
        max-width: 1110px;
        background-color: #fff;
        border-radius: 24px;
        padding: clamp(24px, 4vw, 40px) clamp(24px, 8vw, 100px);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.06);
      }

      .apply-title {
        font-size: clamp(28px, 4vw, 40px);
        font-weight: 600;
        color: #414141;
      }

      .apply-image {
        width: clamp(200px, 28vw, 284px);
        height: auto;
      }

      .apply-arrow {
        width: 56px;
        height: 56px;
        flex-shrink: 0;
      }

      .back-button {
        width: 196px;
        height: 48px;
        background-color: #275d2b;
        border-radius: 24px;
        color: #fff;
        padding: 10px 53px;
        margin: 0 auto 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        cursor: pointer;
      }

      .apply-form {
        width: 100%;
        max-width: 1110px;
        background-color: #fff;
        border-radius: 24px;
        padding: clamp(28px, 5vw, 60px) clamp(24px, 7vw, 100px);
        margin: 0 auto;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.06);
        box-sizing: border-box;
      }

      .form-group {
        margin-bottom: 28px;
      }

      .form-group p {
        font-size: 20px;
        font-weight: 500;
        color: #8f8f8f;
        margin-bottom: 12px;
      }

      .custom-radio {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
        cursor: pointer;
        font-size: 16px;
      }

      .custom-radio input[type="radio"] {
        display: none;
      }

      .radio-icon {
        width: 24px;
        height: 24px;
        background-image: url("./assets/choice-button/default.png");
        background-size: cover;
        margin-right: 10px;
      }

      .custom-radio input[type="radio"]:checked + .radio-icon {
        background-image: url("./assets/choice-button/press.png");
      }

      .custom-radio input[type="radio"]:hover + .radio-icon {
        background-image: url("./assets/choice-button/hover.png");
      }

      .custom-radio input[type="radio"]:focus + .radio-icon {
        background-image: url("./assets/choice-button/focus.png");
      }

      .custom-radio input[type="radio"]:disabled + .radio-icon {
        background-image: url("./assets/choice-button/disabled.png");
      }

      .input-wrapper {
        position: relative;
        margin-top: 12px;
        width: 100%;
      }

      input[type="text"] {
        width: 100%;
        height: 28px;
        border-radius: 8px;
        padding: 0 12px;
        font-size: 16px;
        font-weight: 400;
        border: 1px solid #bfbfbf;
        color: #414141;
      }

      .edit-icon {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
      }

      .submit-button {
        margin-top: 30px;
        background-color: #275d2b;
        color: white;
        font-size: 18px;
        padding: 12px 36px;
        border: none;
        border-radius: 24px;
        cursor: pointer;
      }

      .view-requests-button {
        width: 260px;
        height: 48px;
        background-color: #ecf5eb;
        border: 1px solid #275d2b;
        border-radius: 24px;
        color: #275d2b;
        font-size: 16px;
        font-weight: 500;
        padding: 10px 20px;
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        cursor: pointer;
        text-decoration: none;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .view-requests-button:hover {
        background-color: #d9ebd7;
      }

      .secondary-actions {
        width: 100%;
        max-width: 1110px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: center;
      }

      @media (max-width: 900px) {
        main.apply-page {
          padding: 20px 12px 60px;
        }

        .apply-header {
          flex-direction: column;
          align-items: flex-start;
          text-align: left;
        }

        .apply-arrow {
          align-self: flex-end;
        }

        .back-button {
          margin-top: 0;
        }
      }

      @media (max-width: 600px) {
        .custom-radio {
          align-items: flex-start;
          line-height: 1.4;
        }

        .custom-radio .radio-icon {
          margin-top: 2px;
        }

        input[type="text"] {
          height: 40px;
        }
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <button
        class="burger"
        id="burgerBtn"
        aria-label="Відкрити меню"
        aria-expanded="false"
        aria-controls="sidebar"
      >
        <img src="assets/sidebar/burger.svg" alt="" />
      </button>

      <a href="/" class="header-logo" aria-label="Головна">
        <img src="assets/emblem.svg" alt="IPS" />
      </a>

      <button class="lang-switch" id="langBtn" aria-haspopup="listbox" aria-expanded="false">
        UA ▼
      </button>
    </header>
    <aside class="sidebar collapsed" id="sidebar">
      <div class="toggle-button" onclick="toggleSidebar()">
        <img src="assets/sidebar/arrow.svg" alt="Toggle" id="toggleArrow" />
      </div>
      <img
        class="logo"
        src="assets/sidebar/IPS Logo (2).svg"
        alt="Logo"
        id="logoExpanded"
      />
      <img
        class="logo-collapsed"
        src="assets/sidebar/IPS Logo (1).svg"
        alt="Logo Small"
        id="logoCollapsed"
      />
      <img
        class="profile"
        src="assets/profile-photo.png"
        alt="User"
        width="40"
        height="40"
      />
      <nav>
        <a href="profile.html"
          ><img src="assets/sidebar/profile.svg" /><span>Про Мене</span></a
        >
        <a href="mycertificates.html"
          ><img src="assets/sidebar/news.svg" /><span>Мої Сертифікати</span></a
        >
        <a href="career-faq.html"
          ><img src="assets/sidebar/10.svg" /><span>Планування Кар'єри</span></a
        >
        <a href="library.html"
          ><img src="assets/sidebar/3.svg" /><span>Бібліотека</span></a
        >
        <a href="my-courses.html"
          ><img src="assets/sidebar/5.svg" /><span>Мої Курси</span></a
        >
        <a href="forum/index.html">
  <img src="assets/sidebar/forum.svg" alt="Форум"/>
  <span>Форум</span>
</a>
        <a href="practice-records.html"><img src="assets/practice-records.svg" /><span>Облік Практики</span></a>
      </nav>
      <div class="logout">
        <img
          src="assets/sidebar/log-out.svg"
          alt="Logout Icon"
          width="20"
          height="20"
        />
        <span>Вийти з акаунту</span>
      </div>
    </aside>
    <div class="drawer-backdrop" id="drawerBackdrop"></div>

    <main class="apply-page" id="mainContent">
      <div class="apply-header">
        <div class="apply-title">Подати заявку</div>
        <img class="apply-image" src="./assets/career-apply.png" alt="Person" />
        <img class="apply-arrow" src="./assets/library/arrow.png" alt="Arrow" />
      </div>

      <a href="career-faq.html" class="back-button">
        <img src="./assets/library/arrow-main.svg" alt="Back" /> Головна
      </a>
      <a
        id="applyBtn"
        href="career-mentor-requests.html"
        class="view-requests-button"
        style="display: none;"
      >
        Менторство
      </a>

      <div class="apply-form">
        <div class="form-group">
          <p>До кого Ви звертаєтесь?</p>
          <label class="custom-radio">
            <input type="radio" name="target" value="supervisor" />
            <span class="radio-icon"></span>
            Супервізора
          </label>
          <label class="custom-radio">
            <input type="radio" name="target" value="mentor" />
            <span class="radio-icon"></span>
            Ментора
          </label>
        </div>
        <div class="form-group">
          <p>Скільки років у вас практики:</p>
          <label class="custom-radio">
            <input type="radio" name="experience" value="<7" />
            <span class="radio-icon"></span>
            зовсім початківець/студент або практикуючий до 7 років
          </label>
          <label class="custom-radio">
            <input type="radio" name="experience" value="7-15" />
            <span class="radio-icon"></span>
            практикуючий від 7 до 15 років
          </label>
          <label class="custom-radio">
            <input type="radio" name="experience" value=">15" />
            <span class="radio-icon"></span>
            від 15 і більше років практики
          </label>
        </div>

        <div class="form-group">
          <p>До якої категорії людей за віком Ви відноситесь:</p>
          <label class="custom-radio">
            <input type="radio" name="age" value="до 32" />
            <span class="radio-icon"></span>
            до 32 років
          </label>
          <label class="custom-radio">
            <input type="radio" name="age" value="32-42" />
            <span class="radio-icon"></span>
            від 32 до 42 років
          </label>
          <label class="custom-radio">
            <input type="radio" name="age" value="42-52" />
            <span class="radio-icon"></span>
            від 42 до 52 років
          </label>
          <label class="custom-radio">
            <input type="radio" name="age" value="52-65" />
            <span class="radio-icon"></span>
            від 52 до 65 років
          </label>
          <label class="custom-radio">
            <input type="radio" name="age" value=">65" />
            <span class="radio-icon"></span>
            за 65 років
          </label>
        </div>

        <div class="form-group">
          <p>
            Напишіть, будь ласка, Ваш запит, з яким Ви звертаєтесь до ментора:
          </p>
          <div class="input-wrapper">
            <input id="requestText" type="text" placeholder="Ваш запит..." />
            <img class="edit-icon" src="./assets/edit-icon.svg" alt="Edit" />
          </div>
        </div>

        <div class="form-group">
          <p>
            Напишіть про себе те, що вважаєте за потрібним знати ментору про себе
            та ситуацію:
          </p>
          <div class="input-wrapper">
            <input
              id="aboutText"
              type="text"
              placeholder="Інформація про себе..."
            />
            <img class="edit-icon" src="./assets/edit-icon.svg" alt="Edit" />
          </div>
        </div>

        <button id="submitBtn" type="button" class="submit-button">
          Подати заявку
        </button>
      </div>
      <div class="secondary-actions">
        <a href="career-requests.html" class="view-requests-button">
          Переглянути подані заявки
        </a>
      </div>
    </main>
    <script>
      const API = "http://157.230.121.24:5050/api/career-applications";

      document
        .getElementById("submitBtn")
        .addEventListener("click", async () => {
          const target = document.querySelector(
            'input[name="target"]:checked'
          )?.value;
          const exp = document.querySelector(
            'input[name="experience"]:checked'
          )?.value;
          const age = document.querySelector(
            'input[name="age"]:checked'
          )?.value;
          const requestText = document
            .getElementById("requestText")
            .value.trim();
          const aboutText = document.getElementById("aboutText").value.trim();

          if (!exp || !age || !requestText) {
            alert(
              "Заповніть, будь ласка, обовʼязкові поля (досвід, вік, запит)."
            );
            return;
          }

          try {
            const res = await fetch(API, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              credentials: "include", // если нужна cookie-сессия
              body: JSON.stringify({
                target,
                experience: exp,
                ageGroup: age,
                requestText,
                aboutText,
                fullName: localStorage.getItem("fullName") || undefined,
                email: localStorage.getItem("email") || undefined,
              }),
            });

            const data = await res.json();
            if (!res.ok || !data.ok)
              throw new Error(data.message || "Помилка збереження");

            // Успех: на страницу со списком заявок
            window.location.href = "career-requests.html";
          } catch (e) {
            console.error(e);
            alert("Не вдалося надіслати заявку. Спробуйте ще раз.");
          }
        });

      (function showMentorButtonIfNeeded() {
        fetch("/api/users/profile", { credentials: "include" })
          .then((r) =>
            r
              .json()
              .catch(() => null)
              .then((body) => ({ ok: r.ok, body }))
          )
          .then(({ ok, body }) => {
            if (!ok || !body || !body.user) return;
            const roles = body.user.roles || [];
            const hasMentor =
              Array.isArray(roles) &&
              roles.some(
                (s) =>
                  String(s).toLowerCase().includes("ментор") ||
                  String(s).toLowerCase().includes("mentor")
              );

            if (hasMentor) {
              const mentorBtn = document.getElementById("mentorViewBtn"); // уже существующая
              if (mentorBtn) {
                mentorBtn.style.display = "flex";
                if (
                  new URLSearchParams(location.search).get("view") === "all"
                ) {
                  mentorBtn.textContent = "Менторство (мої заявки)";
                  mentorBtn.href = "career-requests.html?view=mine";
                }
              }
              const applyBtn = document.getElementById("applyBtn"); // НОВАЯ
              if (applyBtn) applyBtn.style.display = "flex";
            }
          })
          .catch(() => {});
      })();
    </script>
    <script src="script.js"></script>
  </body>
</html>
