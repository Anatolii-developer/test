<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—É—Ä—Å</title>
  <link rel="stylesheet" href="admin-styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
   <aside class="sidebar collapsed" id="sidebar">
    <div class="toggle-button" onclick="toggleSidebar()">
      <img src="../assets/sidebar/arrow.svg" alt="Toggle" id="toggleArrow" />
    </div>
  
    <!-- –õ–æ–≥–æ—Ç–∏–ø -->
    <img class="logo" src="../assets/sidebar/IPS Logo (2).svg" alt="Logo" id="logoExpanded" />
    <img class="logo-collapsed" src="../assets/sidebar/IPS Logo (1).svg" alt="Logo Small" id="logoCollapsed" />
  
    <!-- –§–æ—Ç–æ –∏ –∏–º—è -->
    <img class="profile" src="../assets/profile-photo.png" alt="User" width="40" height="40" />

  
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav>
      <a href="admin-requests.html"><img src="../assets/sidebar/profile.svg" /><span>–ü—Ä–æ—Ñ–∞–π–ª–∏</span></a>
      <a href="#"><img src="../assets/sidebar/3.svg" /><span>–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∫–∞—Ä'—î—Ä–∏</span></a>
      <a href="#"><img src="../assets/sidebar/4.svg" /><span>–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞</span></a>
      <a href="admin-all-courses.html"><img src="../assets/sidebar/5.svg" /><span>–ö—É—Ä—Å–∏</span></a>
      <a href="#"><img src="../assets/sidebar/6.svg" /><span>–û–±–ª—ñ–∫ –ø—Ä–∞–∫—Ç–∏–∫–∏</span></a>
      <a href="#"><img src="../assets/sidebar/7.svg" /><span>–ó–¥–æ—Ä–æ–≤‚Äô—è</span></a>
      <a href="#"><img src="../assets/sidebar/8.svg" /><span>–§—ñ–Ω–∞–Ω—Å–∏</span></a>
      <a href="#"><img src="../assets/sidebar/9.svg" /><span>–ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å</span></a>
    </nav>
  
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ + –≤—ã—Ö–æ–¥ -->
    <div style="margin-top: auto;">
      <a href="#"><img src="../assets/sidebar/settings.png" /><span>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span></a>
      <div class="logout" onclick="logoutUser()">
        <img src="../assets/sidebar/log-out.svg" alt="Logout Icon" width="20" height="20" />
        <span>Logout Account</span>
      </div>
    </div>
  </aside>

  <div id="mainContentWrapper">
  <main id="admin-main">


    <div class="completed-nav-buttons">
      <a href="admin-all-courses.html" class="completed-nav-button secondary">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="completed-courses.html" class="completed-nav-button secondary">–ü—Ä–æ–π–¥–µ–Ω—ñ</a>
      <a href="ongoing-courses.html" class="completed-nav-button secondary">–ü–æ—Ç–æ—á–Ω—ñ</a>
      <a href="planned-courses.html" class="completed-nav-button secondary">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ</a>
      <a href="admin-create-course.html" class="completed-nav-button create">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—É—Ä—Å</a>
    </div>

    <section class="create-course-content">
      <form id="createCourseForm">
        <div class="form-group">
          <label>–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –∑–∞—Ö–æ–¥—É</label>
          <div class="radio-group">
            <label><input type="radio" name="eventType" value="–ö—É—Ä—Å" /> –ö—É—Ä—Å</label>
            <label><input type="radio" name="eventType" value="–ì—Ä—É–ø–∞" /> –ì—Ä—É–ø–∞</label>
            <label><input type="radio" name="eventType" value="–°—É–ø–µ—Ä–≤—ñ–∑—ñ—è" /> –°—É–ø–µ—Ä–≤—ñ–∑—ñ—è</label>
            <label><input type="radio" name="eventType" value="–õ–µ–∫—Ü—ñ—è" /> –õ–µ–∫—Ü—ñ—è</label>
            <label><input type="radio" name="eventType" value="–°–µ–º—ñ–Ω–∞—Ä" /> –°–µ–º—ñ–Ω–∞—Ä</label>
          </div>
        </div>

        <div class="form-group">
          <label>–ù–∞–∑–≤–∞ –∫—É—Ä—Å—É</label>
          <input type="text" name="courseTitle" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É" />
        </div>

        <div class="form-group">
          <label>–ü—ñ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫—É—Ä—Å—É</label>
          <input type="text" name="courseSubtitle" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—ñ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫" />
        </div>

        <div class="form-group">
          <label>–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –∫—É—Ä—Å—É</label>
          <textarea name="courseDescription" placeholder="–û–ø–∏—à—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ –∫—É—Ä—Å..."></textarea>
        </div>

        <div class="form-group">
          <label>–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –∫—É—Ä—Å—É</label>
          <div class="date-range">
            <input type="date" name="startDate" />
            <input type="date" name="endDate" />
          </div>
        </div>

        <div class="form-group">
          <label>–û–±–µ—Ä—ñ—Ç—å –¥–Ω—ñ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –∫—É—Ä—Å—É</label>
          <div class="weekdays-checkboxes">
            <label><input type="checkbox" name="courseDays" value="–ü–æ–Ω–µ–¥—ñ–ª–æ–∫" /> –ü–æ–Ω–µ–¥—ñ–ª–æ–∫</label>
            <label><input type="checkbox" name="courseDays" value="–í—ñ–≤—Ç–æ—Ä–æ–∫" /> –í—ñ–≤—Ç–æ—Ä–æ–∫</label>
            <label><input type="checkbox" name="courseDays" value="–°–µ—Ä–µ–¥–∞" /> –°–µ—Ä–µ–¥–∞</label>
            <label><input type="checkbox" name="courseDays" value="–ß–µ—Ç–≤–µ—Ä" /> –ß–µ—Ç–≤–µ—Ä</label>
            <label><input type="checkbox" name="courseDays" value="–ü‚Äô—è—Ç–Ω–∏—Ü—è" /> –ü‚Äô—è—Ç–Ω–∏—Ü—è</label>
            <label><input type="checkbox" name="courseDays" value="–°—É–±–æ—Ç–∞" /> –°—É–±–æ—Ç–∞</label>
            <label><input type="checkbox" name="courseDays" value="–ù–µ–¥—ñ–ª—è" /> –ù–µ–¥—ñ–ª—è</label>
          </div>
        </div>

        <div class="form-group">
          <label>–û–±–µ—Ä—ñ—Ç—å –≥–æ–¥–∏–Ω–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è</label>
          <div class="time-range">
            <input type="time" name="startTime" />
            <span>‚Äì</span>
            <input type="time" name="endTime" />
          </div>
        </div>

        <div class="form-group">
          <label>–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –∫—É—Ä—Å—É</label>
          <div class="radio-group">
            <label><input type="radio" name="accessType" value="–í—ñ–¥–∫—Ä–∏—Ç–∞ –≥—Ä—É–ø–∞" /> –í—ñ–¥–∫—Ä–∏—Ç–∞ –≥—Ä—É–ø–∞</label>
            <label><input type="radio" name="accessType" value="–ó–∞–∫—Ä–∏—Ç–∞ –≥—Ä—É–ø–∞" /> –ó–∞–∫—Ä–∏—Ç–∞ –≥—Ä—É–ø–∞</label>
          </div>
        </div>

       <div class="form-group">
  <label>–û–±–µ—Ä—ñ—Ç—å —É—á–∞—Å–Ω–∏–∫—ñ–≤</label>
  <select name="participants" id="participantsSelect" multiple></select>
  <button type="button" onclick="openUserModal()" class="small-button">+ –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ</button>
</div>
<div class="form-group">
  <label>–û–±—Ä–∞–Ω—ñ —É—á–∞—Å–Ω–∏–∫–∏</label>
  <div id="selectedParticipants" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
</div>


        <div class="form-group">
          <label>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∫—É—Ä—Å—É</label>
          <input type="text" name="courseDuration" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 4 —Ç–∏–∂–Ω—ñ, 8 –∑–∞–Ω—è—Ç—å" />
        </div>

        <div class="form-group">
          <label>–í–∞—Ä—Ç—ñ—Å—Ç—å –∫—É—Ä—Å—É</label>
          <input type="text" name="coursePrice" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 1200 –≥—Ä–Ω" />
        </div>

        <div class="form-group">
          <label>–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Zoom</label>
          <input type="text" name="zoomLink" placeholder="–í—Å—Ç–∞–≤—Ç–µ Zoom-–ø–æ—Å–∏–ª–∞–Ω–Ω—è" />
        </div>

        <div class="save-btn-wrapper">
          <button type="submit" class="save-btn">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        </div>
      </form>
    </section>
  </main>
  </div>
 <script>


let allUsers = [];
let selectedUserIds = new Set();



function renderUserList(users) {
  const userList = document.getElementById("userList");
  userList.innerHTML = "";
  users.forEach(user => {
    const fullName = getFullName(user);
    const div = document.createElement("div");
    div.innerHTML = `<label><input type="checkbox" value="${user._id}" ${selectedUserIds.has(user._id) ? 'checked' : ''}/> ${fullName || user.email}</label>`;
    userList.appendChild(div);
  });
}



async function openUserModal() {
  try {
    const res = await fetch("http://157.230.121.24:5050/api/users");
    const users = await res.json();
    allUsers = users;
    renderUserList(users);
    document.getElementById("userModal").style.display = "flex";
  } catch (err) {
    console.error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤", err);
    alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞");
  }
}


function closeUserModal() {
  document.getElementById("userModal").style.display = "none";
}



    function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const arrow = document.getElementById('toggleArrow');

  sidebar.classList.toggle('expanded');
  sidebar.classList.toggle('collapsed');

  arrow.style.transform = sidebar.classList.contains('expanded') ? 'rotate(180deg)' : 'rotate(0deg)';
}

function logoutUser() {
  window.location.href = "login.html";
}


async function loadParticipants() {
  try {
    const res = await fetch("http://157.230.121.24:5050/api/users"); // üü° –ø—É—Ç—å –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–≤–æ–µ–º—É API
    const users = await res.json();

    const select = document.getElementById("participantsSelect");
    users.forEach(user => {
      const option = document.createElement("option");
      option.value = user._id;
      option.textContent = user.fullName || user.email || "User";
      select.appendChild(option);
    });
  } catch (err) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —É—á–∞—Å–Ω–∏–∫—ñ–≤", err);
  }
}

window.addEventListener("DOMContentLoaded", loadParticipants);


document.getElementById("createCourseForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const form = e.target;
const formData = {
  eventType: form.eventType.value,
  courseTitle: form.courseTitle.value,
  courseSubtitle: form.courseSubtitle.value,
  courseDescription: form.courseDescription.value,
  courseDates: {
    start: form.startDate.value,
    end: form.endDate.value
  },
  courseDays: [...form.querySelectorAll('input[name="courseDays"]:checked')].map(cb => cb.value),
  courseTime: {
    start: form.startTime.value,
    end: form.endTime.value
  },
  accessType: form.accessType.value,
  courseDuration: form.courseDuration.value,
  coursePrice: form.coursePrice.value,
  zoomLink: form.zoomLink.value,
  participants: Array.from(selectedUserIds), // ‚úÖ —Ñ–∏–∫—Å
};



  const res = await fetch("http://157.230.121.24:5050/api/courses", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(formData)
  });

  const result = await res.json();
  if (result.success) {
    alert("–ö—É—Ä—Å —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ");
    form.reset();
  } else {
    alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –∫—É—Ä—Å—É");
  }
});

function updateSelectedDisplay() {
  const container = document.getElementById("selectedParticipants");
  container.innerHTML = "";
  const select = document.getElementById("participantsSelect");
  select.innerHTML = "";

  allUsers.forEach(user => {
    if (selectedUserIds.has(user._id)) {
      const fullName = getFullName(user);
      const badge = document.createElement("span");
      badge.className = "tag";
      badge.innerHTML = `${fullName || user.email} <button class="remove-btn" onclick="removeSelected('${user._id}')">‚úñ</button>`;
      container.appendChild(badge);

      const opt = document.createElement("option");
      opt.value = user._id;
      opt.selected = true;
      select.appendChild(opt);
    }
  });
}


function removeSelected(id) {
  selectedUserIds.delete(id);
  updateSelectedDisplay();
}


function confirmParticipants() {
  const checkboxes = document.querySelectorAll('#userList input[type="checkbox"]');
  checkboxes.forEach(cb => {
    if (cb.checked) selectedUserIds.add(cb.value);
    else selectedUserIds.delete(cb.value);
  });
  updateSelectedDisplay();
  document.getElementById("userModal").style.display = "none";
}

function getFullName(user) {
  return [user.firstName, user.lastName].filter(Boolean).join(" ");
}

function filterUsers() {
  const query = document.getElementById("userSearch").value.toLowerCase();
  const filtered = allUsers.filter(user => {
    const fullName = getFullName(user).toLowerCase();
    return fullName.includes(query);
  });
  renderUserList(filtered);
}



async function createNewUser() {
  const fullName = document.getElementById("newUserFullName").value.trim();
  const email = document.getElementById("newUserEmail").value.trim();

  if (!fullName || !email) {
    alert("–í–≤–µ–¥—ñ—Ç—å —ñ–º º—è —Ç–∞ email");
    return;
  }

  try {
    const res = await fetch("http://157.230.121.24:5050/api/users", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ fullName, email })
    });

    const newUser = await res.json();

    const select = document.getElementById("participantsSelect");
    const option = document.createElement("option");
    option.value = newUser._id;
    option.textContent = newUser.fullName || newUser.email;
    option.selected = true;
    select.appendChild(option);

    closeUserModal();
  } catch (err) {
    alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞");
    console.error(err);
  }
}

  </script>

<div id="userModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>–û–±—Ä–∞—Ç–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤</h3>
    <input type="text" id="userSearch" placeholder="–ü–æ—à—É–∫..." oninput="filterUsers()" />
    <div id="userList" style="max-height: 200px; overflow-y: auto; margin: 10px 0;"></div>
    <button onclick="confirmParticipants()">–î–æ–¥–∞—Ç–∏ –≤–∏–±—Ä–∞–Ω–∏—Ö</button>
    <button onclick="closeUserModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>
</div>

</body>
</html>
