<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –º–æ—ó—Ö –∫—É—Ä—Å—ñ–≤</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Section (folder) dropdowns */
    .section {
      margin: 12px 0 16px;
      border-radius: 12px;
      background: #FFEED9;
      padding: 0;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.06);
    }
    .section summary {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      list-style: none;
      padding: 14px 16px;
      font-weight: 600;
      user-select: none;
    }
    .section[open] summary {
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .section summary::-webkit-details-marker { display: none; }

    .materials {
      padding: 12px 16px;
      display: grid;
      gap: 12px;
    }
    .material-row {
      display: grid;
      gap: 8px;
      background: #fff;
      border-radius: 10px;
      padding: 12px;
      border: 1px solid #eee;
    }
    .material-row .row-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .material-title {
      font-weight: 600;
    }
    .material-desc {
      opacity: 0.8;
      font-size: 14px;
      line-height: 1.45;
    }
    .view-btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid #D97A1C;
      background: transparent;
      color: #D97A1C;
      cursor: pointer;
    }
    .preview {
      margin-top: 10px;
      display: none;
    }
    .preview.active { display: block; }
    .preview iframe, .preview embed {
      width: 100%;
      height: 420px;
      border: 0;
      border-radius: 10px;
      background: #fff;
    }
  </style>
</head>
<body>
   <aside class="sidebar collapsed" id="sidebar">
    <div class="toggle-button" onclick="toggleSidebar()">
      <img src="assets/sidebar/arrow.svg" alt="Toggle" id="toggleArrow" />
    </div>
    <img class="logo" src="assets/sidebar/IPS Logo (2).svg" alt="Logo" id="logoExpanded" />
    <img class="logo-collapsed" src="assets/sidebar/IPS Logo (1).svg" alt="Logo Small" id="logoCollapsed" />
    <img class="profile" src="assets/profile-photo.png" alt="User" width="40" height="40" />
    <nav>
      <a href="profile.html"><img src="assets/sidebar/profile.svg" /><span>–ü—Ä–æ –ú–µ–Ω–µ</span></a>
      <a href="mycertificates.html"><img src="assets/sidebar/news.svg" /><span>–ú–æ—ó –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</span></a>
      <a href="career-faq.html"><img src="assets/sidebar/10.svg" /><span>–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –ö–∞—Ä'—î—Ä–∏</span></a>
      <a href="library.html"><img src="assets/sidebar/3.svg" /><span>–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞</span></a>
      <a href="my-courses.html"><img src="assets/sidebar/5.svg" /><span>–ú–æ—ó –ö—É—Ä—Å–∏</span></a>
      <a href="#"><img src="assets/sidebar/8.svg" /><span>–û–±–ª—ñ–∫</span></a>
    </nav>
    <div class="logout">
      <img src="assets/sidebar/log-out.svg" alt="Logout Icon" width="20" height="20" />
      <span>–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É</span>
    </div>
  </aside>

  <main id="mainContent">
    <!-- Title Block -->
    <div class="main-header">
      <h2>–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –º–æ—ó—Ö –∫—É—Ä—Å—ñ–≤</h2>
      <img src="assets/library/courses.png" alt="Courses Image" />
    </div>

    <!-- Navigation Buttons -->
    <div class="nav-buttons">
    <a href="library.html">
      <button class="nav-button"><img src="assets/library/arrow-main.svg" alt="Back" />–ì–æ–ª–æ–≤–Ω–∞</button>
    </a>
    <a href="main-library.html">
      <button class="nav-button secondary">–ó–∞–≥–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</button>
    </a>
      <a href="addons-library.html">
      <button class="nav-button secondary">–î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</button>
    </a>
    </div>
    

    <!-- Content Block -->
    <section class="materials-library-content">

      <!-- Filter -->
      <div class="date-section">
        <label class="date-label">Publishing Date (DD/MM/YYYY)</label>
        <div class="date-inputs">
          <input type="date" class="date-input" />
          <input type="date" class="date-input" />
        </div>
        <div class="filter-btn-wrapper">
          <button class="filter-btn">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
        </div>
      </div>

      <!-- Course Items -->
      <div class="course-list">
        <div class="course-item">
            <h4 class="course-title">¬´–ö—Ä–∏–∑–æ–≤–∞ —ñ–Ω—Ç–µ—Ä–≤–µ–Ω—Ü—ñ—è –≤ –ø—Å–∏—Ö–æ–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–æ–º—É –ø—ñ–¥—Ö–æ–¥—ñ¬ª</h4>
            <p class="course-description">
              –ú–æ–¥—É–ª—å I –∑ 2-—Ö —Ä—ñ—á–Ω–æ—ó –∫–≤–∞–ª—ñ—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ –∑ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó –ø—Å–∏—Ö–æ–ª–æ–≥–∞ –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏.
            </p>
            <div class="lecture-materials-row">
              <strong>–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –ª–µ–∫—Ü—ñ—ó</strong>
              <button class="view-btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
            </div>
          </div>
        

          <div class="course-item">
            <h4 class="course-title">¬´–ö—Ä–∏–∑–æ–≤–∞ —ñ–Ω—Ç–µ—Ä–≤–µ–Ω—Ü—ñ—è –≤ –ø—Å–∏—Ö–æ–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–æ–º—É –ø—ñ–¥—Ö–æ–¥—ñ¬ª</h4>
            <p class="course-description">–ú–æ–¥—É–ª—å I –∑ 2-—Ö —Ä—ñ—á–Ω–æ—ó –∫–≤–∞–ª—ñ—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏...</p>
          
            <div class="week-block">
              <button class="accordion-toggle">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –ª–µ–∫—Ü—ñ—ó</button>
              <div class="accordion-content">
                <div class="lecture-row">
                  <span>–í—ñ–¥–µ–æ-–º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –ª–µ–∫—Ü—ñ—ó</span>
                  <button class="view-btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
                </div>
                <div class="lecture-row">
                  <span>–ö–Ω–∏–∂–∫–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –ª–µ–∫—Ü—ñ—ó</span>
                  <button class="view-btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
                </div>
              </div>
            </div>
          
            <div class="week-block">
              <button class="accordion-toggle">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ —Å—É–ø–µ—Ä–≤—ñ–∑—ñ—ó</button>
              <!-- Empty content for now -->
            </div>
          </div>
        

          <div class="course-item">
            <h4 class="course-title">¬´–ö—Ä–∏–∑–æ–≤–∞ —ñ–Ω—Ç–µ—Ä–≤–µ–Ω—Ü—ñ—è –≤ –ø—Å–∏—Ö–æ–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–æ–º—É –ø—ñ–¥—Ö–æ–¥—ñ¬ª</h4>
            <p class="course-description">–ú–æ–¥—É–ª—å I –∑ 2-—Ö —Ä—ñ—á–Ω–æ—ó –∫–≤–∞–ª—ñ—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏...</p>
          
            <div class="week-block">
              <button class="accordion-toggle">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –ª–µ–∫—Ü—ñ—ó</button>
              <div class="accordion-content">
                <div class="lecture-row">
                  <span>–í—ñ–¥–µ–æ-–º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –ª–µ–∫—Ü—ñ—ó</span>
                  <button class="view-btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
                </div>
                <div class="lecture-row">
                  <span>–ö–Ω–∏–∂–∫–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –ª–µ–∫—Ü—ñ—ó</span>
                  <button class="view-btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
                </div>
              </div>
            </div>
          
            <div class="week-block">
              <button class="accordion-toggle">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ —Å—É–ø–µ—Ä–≤—ñ–∑—ñ—ó</button>
              <!-- Empty content for now -->
            </div>
          </div>
        
      </div>
    </section>
  </main>
  <script src="script.js"></script>
  <script>
    const API_BASE = "http://157.230.121.24:5050";

    window.onload = () => {
      loadCourseMaterials(); // –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    };

    function getYouTubeEmbedUrl(link) {
      const m = String(link || '').match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([\w-]{11})/);
      return m ? `https://www.youtube.com/embed/${m[1]}` : "";
    }

    // üîÑ –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–∞ —Ä–µ–Ω–¥–µ—Ä –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤: –≥—Ä—É–ø—É—î–º–æ –∑–∞ –∫—É—Ä—Å–æ–º, –ø–æ—Ç—ñ–º –∑–∞ –ø–∞–ø–∫–æ—é (section)
    async function loadCourseMaterials() {
      try {
        const res = await fetch(`${API_BASE}/api/library?destination=courses`);
        const materials = await res.json();

        const courseList = document.querySelector(".course-list");
        courseList.innerHTML = "";

        if (!Array.isArray(materials) || !materials.length) {
          courseList.innerHTML = "<p>–ù–∞—Ä–∞–∑—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ.</p>";
          return;
        }

        // –£–Ω—ñ–∫–∞–ª—å–Ω—ñ courseId
        const byCourse = new Map(); // courseKey -> items[]
        const courseIds = new Set();
        for (const it of materials) {
          const key = it.courseId || "_no_course_";
          if (!byCourse.has(key)) byCourse.set(key, []);
          byCourse.get(key).push(it);
          if (it.courseId) courseIds.add(String(it.courseId));
        }

        // –ü—ñ–¥—Ç—è–≥–Ω–µ–º–æ –¥–∞–Ω—ñ –∫—É—Ä—Å—ñ–≤
        const courseMeta = new Map(); // id -> { title, description }
        for (const cid of courseIds) {
          try {
            const r = await fetch(`${API_BASE}/api/courses/${cid}`);
            if (r.ok) {
              const c = await r.json();
              courseMeta.set(cid, {
                title: c.courseTitle || "–ö—É—Ä—Å",
                description: c.courseSubtitle || c.courseDescription || ""
              });
            }
          } catch (_) {}
        }

        // –ü–æ–±—É–¥–æ–≤–∞ DOM
        for (const [courseKey, items] of byCourse.entries()) {
          const meta = courseMeta.get(String(courseKey)) || {
            title: inferCourseTitle(items),
            description: "–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏, –¥–æ–¥–∞–Ω—ñ –¥–æ —Ü—å–æ–≥–æ –∫—É—Ä—Å—É"
          };

          const courseItem = document.createElement("div");
          courseItem.className = "course-item";
          courseItem.innerHTML = `
            <h4 class="course-title">${escapeHtml(meta.title)}</h4>
            <p class="course-description">${escapeHtml(meta.description)}</p>
          `;

          // –ì—Ä—É–ø—É—î–º–æ –∑–∞ –ø–∞–ø–∫–æ—é (section); —è–∫—â–æ –≤—ñ–¥—Å—É—Ç–Ω—è ‚Äî "–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏"
          const bySection = new Map();
          for (const it of items) {
            const section = (it.section && String(it.section).trim()) || "–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏";
            if (!bySection.has(section)) bySection.set(section, []);
            bySection.get(section).push(it);
          }

          for (const [sectionName, sItems] of bySection.entries()) {
            const details = document.createElement("details");
            details.className = "section";
            details.innerHTML = `
              <summary class="section-summary">üìÅ ${escapeHtml(sectionName)}</summary>
              <div class="materials"></div>
            `;
            const materialsWrap = details.querySelector(".materials");

            sItems.forEach((mat, idx) => {
              const row = document.createElement("div");
              row.className = "material-row";

              const title = mat.itemTitle || mat.title || (mat.type === "video" ? "–í—ñ–¥–µ–æ" : "–§–∞–π–ª");
              const desc  = mat.description || "";

              row.innerHTML = `
                <div class="row-head">
                  <div>
                    <div class="material-title">${escapeHtml(title)}</div>
                    ${desc ? `<div class="material-desc">${escapeHtml(desc)}</div>` : ""}
                  </div>
                  <button class="view-btn" type="button">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
                </div>
                <div class="preview" id="prev-${courseKey}-${cssSafe(sectionName)}-${idx}"></div>
              `;

              const btn = row.querySelector(".view-btn");
              const preview = row.querySelector(".preview");
              btn.addEventListener("click", () => renderPreview(preview, mat));

              materialsWrap.appendChild(row);
            });

            courseItem.appendChild(details);
          }

          courseList.appendChild(courseItem);
        }

        initAccordionDefaults();

      } catch (err) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤:", err);
        const courseList = document.querySelector(".course-list");
        if (courseList) courseList.innerHTML = "<p>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤.</p>";
      }
    }

    function renderPreview(container, mat) {
      if (!container) return;
      // –ü–µ—Ä–µ–º–∏–∫–∞—á –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
      const isActive = container.classList.contains("active");
      document.querySelectorAll(".preview.active").forEach(el => el.classList.remove("active"));
      if (isActive) { container.classList.remove("active"); container.innerHTML = ""; return; }
      container.classList.add("active");

      if (mat.type === "video") {
        const src = getYouTubeEmbedUrl(mat.videoLink);
        container.innerHTML = src
          ? `<iframe src="${src}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="–í—ñ–¥–µ–æ"></iframe>`
          : `<div class="material-desc">–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤—ñ–¥–µ–æ.</div>`;
        return;
      }

      // –§–∞–π–ª–∏
      const rawPath = mat.filePath || "";
      const url = rawPath.startsWith("http") ? rawPath : `${API_BASE}/${rawPath.replace(/^\/+/, '')}`;

      const ext = (rawPath.split(".").pop() || "").toLowerCase();
      if (ext === "pdf") {
        container.innerHTML = `<embed src="${url}" type="application/pdf" />`;
      } else if (["doc","docx","ppt","pptx"].includes(ext)) {
        const gview = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(url)}`;
        container.innerHTML = `<iframe src="${gview}" title="–ü—Ä–µ–≤'—é —Ñ–∞–π–ª—É"></iframe>`;
      } else {
        container.innerHTML = `
          <div class="material-desc">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. 
            <a href="${url}" target="_blank" rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª</a>
          </div>`;
      }
    }

    function initAccordionDefaults() {
      // –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–∞–ª–∏—à–∞—î–º–æ –∑–≥–æ—Ä–Ω—É—Ç–∏–º–∏; —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è–º –∫–µ—Ä—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
    }

    function inferCourseTitle(items) {
      // –§–æ–ª–±–µ–∫, —è–∫—â–æ –Ω–µ–º–∞—î –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –∫—É—Ä—Å—É: –±–µ—Ä–µ–º –ø–µ—Ä—à–∏–π title
      const t = items.find(i => i.courseTitle) ?.courseTitle
            || items.find(i => i.title)?.title
            || "–ö—É—Ä—Å";
      return t;
    }

    function escapeHtml(s) {
      return String(s || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function cssSafe(s) {
      return String(s || "").replace(/[^a-z0-9_-]+/gi, "-");
    }

    // ‚è¨ –ê–∫–∫–æ—Ä–¥–µ–æ–Ω—ã (—Å—Ç–∞—Ä–∏–π –∫–æ–¥ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω)
  </script>
</body>
</html>
