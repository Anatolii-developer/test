<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Подати заявку</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #97C194;
      color: #414141;
    }

    .apply-header {
      width: 1110px;
      height: 212px;
      background-color: #fff;
      border-radius: 24px;
      margin: 40px auto 20px;
      padding: 40px 100px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .apply-title {
      font-size: 40px;
      font-weight: 600;
      color: #414141;
    }

    .apply-image {
      width: 284px;
      height: 164px;
    }

    .apply-arrow {
      width: 64px;
      height: 64px;
    }

    .back-button {
      width: 196px;
      height: 48px;
      background-color: #275D2B;
      border-radius: 24px;
      color: #fff;
      padding: 10px 53px;
      margin: 0 auto 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      cursor: pointer;
    }

    .apply-form {
      width: 1110px;
      background-color: #fff;
      border-radius: 24px;
      padding: 60px 100px;
      margin: 0 auto;
    }

    .form-group {
      margin-bottom: 30px;
    }

    .form-group p {
      font-size: 20px;
      font-weight: 500;
      color: #8F8F8F;
      margin-bottom: 12px;
    }

    .custom-radio {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
      cursor: pointer;
      font-size: 16px;
    }

    .custom-radio input[type="radio"] {
      display: none;
    }

    .radio-icon {
      width: 24px;
      height: 24px;
      background-image: url('./assets/choice-button/default.png');
      background-size: cover;
      margin-right: 10px;
    }

    .custom-radio input[type="radio"]:checked + .radio-icon {
      background-image: url('./assets/choice-button/press.png');
    }

    .custom-radio input[type="radio"]:hover + .radio-icon {
      background-image: url('./assets/choice-button/hover.png');
    }

    .custom-radio input[type="radio"]:focus + .radio-icon {
      background-image: url('./assets/choice-button/focus.png');
    }

    .custom-radio input[type="radio"]:disabled + .radio-icon {
      background-image: url('./assets/choice-button/disabled.png');
    }

    .input-wrapper {
      position: relative;
      margin-top: 12px;
    }

    input[type="text"] {
      width: 910px;
      height: 28px;
      border-radius: 8px;
      padding: 0 12px;
      font-size: 16px;
      font-weight: 400;
      border: 1px solid #BFBFBF;
      color: #414141;
    }

    .edit-icon {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
    }

    .submit-button {
      margin-top: 30px;
      background-color: #275D2B;
      color: white;
      font-size: 18px;
      padding: 12px 36px;
      border: none;
      border-radius: 24px;
      cursor: pointer;
    }

    .view-requests-button {
  width: 260px;
  height: 48px;
  background-color: #ECF5EB;
  border: 1px solid #275D2B;
  border-radius: 24px;
  color: #275D2B;
  font-size: 16px;
  font-weight: 500;
  padding: 10px 20px;
  margin: 0 auto 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  cursor: pointer;
  text-decoration: none;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.view-requests-button:hover {
  background-color: #d9ebd7;
}

  </style>
</head>
<body>
    <aside class="sidebar collapsed" id="sidebar">
    <div class="toggle-button" onclick="toggleSidebar()">
      <img src="assets/sidebar/arrow.svg" alt="Toggle" id="toggleArrow" />
    </div>
    <img class="logo" src="assets/sidebar/IPS Logo (2).svg" alt="Logo" id="logoExpanded" />
    <img class="logo-collapsed" src="assets/sidebar/IPS Logo (1).svg" alt="Logo Small" id="logoCollapsed" />
    <img class="profile" src="assets/profile-photo.png" alt="User" width="40" height="40" />
    <nav>
      <a href="profile.html"><img src="assets/sidebar/profile.svg" /><span>Про Мене</span></a>
      <a href="#"><img src="assets/sidebar/news.svg" /><span>Мої Сертифікати</span></a>
      <a href="#"><img src="assets/sidebar/10.svg" /><span>Планування Кар'єри</span></a>
      <a href="library.html"><img src="assets/sidebar/3.svg" /><span>Бібліотека</span></a>
      <a href="my-courses.html"><img src="assets/sidebar/5.svg" /><span>Мої Курси</span></a>
      <a href="#"><img src="assets/sidebar/8.svg" /><span>Облік</span></a>
      <a href="#"><img src="assets/sidebar/4.svg" /><span>Здоров’я</span></a>
      <a href="#"><img src="assets/sidebar/9.svg" /><span>Фінанси</span></a>
      <a href="#"><img src="assets/sidebar/6.svg" /><span>Нерухомість</span></a>
    </nav>
    <div class="logout">
      <img src="assets/sidebar/log-out.svg" alt="Logout Icon" width="20" height="20" />
      <span>Вийти з акаунту</span>
    </div>
  </aside>

  <div class="apply-header">
    <div class="apply-title">Подати заявку</div>
    <img class="apply-image" src="./assets/career-apply.png" alt="Person" />
    <img class="apply-arrow" src="./assets/library/arrow.png" alt="Arrow" />
  </div>

  <a href="career-faq.html" class="back-button">
    <img src="./assets/library/arrow-main.svg" alt="Back" /> Головна
  </a>
  <a id="applyBtn" href="career-mentor-application.html"
   class="view-requests-button"
   style="display:none; margin-top:-20px;">
  Менторство
</a>

<a href="career-requests.html" class="view-requests-button">
  Переглянути подані заявки
</a>


  <div class="apply-form">
    <div class="form-group">
      <p>Скільки років у вас практики:</p>
      <label class="custom-radio">
        <input type="radio" name="experience" value="<7" />
        <span class="radio-icon"></span>
        зовсім початківець/студент або практикуючий до 7 років
      </label>
      <label class="custom-radio">
        <input type="radio" name="experience" value="7-15" />
        <span class="radio-icon"></span>
        практикуючий від 7 до 15 років
      </label>
      <label class="custom-radio">
        <input type="radio" name="experience" value=">15" />
        <span class="radio-icon"></span>
        від 15 і більше років практики
      </label>
    </div>

    <div class="form-group">
      <p>До якої категорії людей за віком Ви відноситесь:</p>
      <label class="custom-radio">
        <input type="radio" name="age" value="до 32" />
        <span class="radio-icon"></span>
        до 32 років
      </label>
      <label class="custom-radio">
        <input type="radio" name="age" value="32-42" />
        <span class="radio-icon"></span>
        від 32 до 42 років
      </label>
      <label class="custom-radio">
        <input type="radio" name="age" value="42-52" />
        <span class="radio-icon"></span>
        від 42 до 52 років
      </label>
      <label class="custom-radio">
        <input type="radio" name="age" value="52-65" />
        <span class="radio-icon"></span>
        від 52 до 65 років
      </label>
      <label class="custom-radio">
        <input type="radio" name="age" value=">65" />
        <span class="radio-icon"></span>
        за 65 років
      </label>
    </div>

    <div class="form-group">
      <p>Напишіть, будь ласка, Ваш запит, з яким Ви звертаєтесь до ментора:</p>
      <div class="input-wrapper">
        <input id="requestText" type="text" placeholder="Ваш запит..." />
        <img class="edit-icon" src="./assets/edit-icon.svg" alt="Edit" />
      </div>
    </div>

    <div class="form-group">
      <p>Напишіть про себе те, що вважаєте за потрібним знати ментору про себе та ситуацію:</p>
      <div class="input-wrapper">
        <input id="aboutText" type="text" placeholder="Інформація про себе..." />
        <img class="edit-icon" src="./assets/edit-icon.svg" alt="Edit" />
      </div>
    </div>

    <button id="submitBtn" type="button" class="submit-button">Подати заявку</button>
  </div>
  <a href="career-requests.html" class="submit-button" style="display:inline-block; text-decoration:none; text-align:center; margin-left:100px; background-color:#ECF5EB; color:#275D2B; font-weight:500;">Переглянути подані заявки</a>
  <script>
const API = "http://157.230.121.24:5050/api/career-applications";

document.getElementById("submitBtn").addEventListener("click", async () => {
  const exp = document.querySelector('input[name="experience"]:checked')?.value;
  const age = document.querySelector('input[name="age"]:checked')?.value;
  const requestText = document.getElementById("requestText").value.trim();
  const aboutText = document.getElementById("aboutText").value.trim();

  if (!exp || !age || !requestText) {
    alert("Заповніть, будь ласка, обовʼязкові поля (досвід, вік, запит).");
    return;
  }

  try {
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include", // если нужна cookie-сессия
      body: JSON.stringify({
        experience: exp,
        ageGroup: age,
        requestText,
        aboutText,

        // Если нет логина — можешь отправить имя/email из localStorage или отдельными полями формы:
        fullName: localStorage.getItem("fullName") || undefined,
        email: localStorage.getItem("email") || undefined,
      }),
    });

    const data = await res.json();
    if (!res.ok || !data.ok) throw new Error(data.message || "Помилка збереження");

    // Успех: на страницу со списком заявок
    window.location.href = "career-requests.html";
  } catch (e) {
    console.error(e);
    alert("Не вдалося надіслати заявку. Спробуйте ще раз.");
  }
});

(function showMentorButtonIfNeeded(){
  fetch("/api/users/profile", { credentials: "include" })
    .then(r => r.json().catch(()=>null).then(body => ({ ok:r.ok, body })))
    .then(({ok, body})=>{
      if (!ok || !body || !body.user) return;
      const roles = body.user.roles || [];
      const hasMentor = Array.isArray(roles) &&
        roles.some(s => String(s).toLowerCase().includes('ментор') ||
                        String(s).toLowerCase().includes('mentor'));

      if (hasMentor) {
        const mentorBtn = document.getElementById('mentorViewBtn'); // уже существующая
        if (mentorBtn) {
          mentorBtn.style.display = 'flex';
          if ((new URLSearchParams(location.search)).get('view') === 'all') {
            mentorBtn.textContent = 'Менторство (мої заявки)';
            mentorBtn.href = 'career-requests.html?view=mine';
          }
        }
        const applyBtn = document.getElementById('applyBtn'); // НОВАЯ
        if (applyBtn) applyBtn.style.display = 'flex';
      }
    })
    .catch(()=>{});
})();
</script>
 <script src="script.js"></script>
</body>
</html>
