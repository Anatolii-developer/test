<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–î–µ—Ç–∞–ª—ñ –∫—É—Ä—Å—É</title>
    <link rel="stylesheet" href="admin-styles.css" />
    <style>
      .course-detail {
        width: 890px;
        margin: 40px auto;
        padding: 60px 100px;
        border-radius: 24px;
        background: #fffef9;
        font-family: "Poppins", sans-serif;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .editable-block {
        position: relative;
        display: flex;
        flex-direction: column;
      }

      .editable-block label {
        font-weight: 600;
        margin-bottom: 6px;
      }

      .editable-block textarea {
        resize: vertical;
        padding: 12px;
        font-size: 16px;
        border: 2px solid #e37009;
        border-radius: 8px;
        background-color: #fffef9;
        color: #333;
        min-height: 48px;
      }

      .editable-block textarea[disabled] {
        background-color: #f0f0f0;
        color: #888;
        border: 1px solid #ccc;
        cursor: not-allowed;
      }

      .editable-block input[type="text"],
      .editable-block input[disabled] {
        padding: 12px;
        font-size: 16px;
        border: 2px solid #e37009;
        border-radius: 8px;
        background-color: #fffef9;
        color: #333;
        min-height: 48px;
      }

      .editable-block input[disabled] {
        background-color: #f0f0f0;
        color: #888;
        border: 1px solid #ccc;
        cursor: not-allowed;
      }

      .edit-btn {
        position: absolute;
        right: 10px;
        top: 38px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
      }

      .edit-btn img {
        width: 20px;
        height: 20px;
      }

      .submit-btn {
        align-self: flex-end;
        margin-top: 20px;
        background-color: #e37009;
        color: white;
        border: none;
        padding: 14px 24px;
        font-size: 16px;
        font-weight: 500;
        border-radius: 8px;
        cursor: pointer;
      }
      .submit-btn.danger {
        background: #a31d1d;
      }
    </style>
  </head>
  <body class="with-sidebar">
    <aside class="sidebar" id="sidebar"></aside>

    <div class="course-detail">
      <h1>–î–µ—Ç–∞–ª—ñ –∫—É—Ä—Å—É</h1>
      <div style="display: flex; gap: 24px; flex-wrap: wrap">
        <div class="editable-block" style="min-width: 260px; flex: 1">
          <label>–°—Ç–≤–æ—Ä–∏–≤</label>
          <input id="creatorName" type="text" disabled />
        </div>
        <div class="editable-block" style="min-width: 220px; flex: 1">
          <label>–†–æ–ª—å</label>
          <input id="creatorRole" type="text" disabled />
        </div>
      </div>
      <div class="editable-block">
        <label>–ù–∞–∑–≤–∞ –∫—É—Ä—Å—É</label>
        <textarea id="title" disabled></textarea>
        <button class="edit-btn" onclick="enableEdit('title')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–¢–∏–ø (—ñ–Ω—Ñ–æ)</label>
        <textarea id="eventType" disabled></textarea>
      </div>

      <div class="editable-block">
        <label>–ü—ñ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
        <textarea id="subtitle" disabled></textarea>
        <button class="edit-btn" onclick="enableEdit('subtitle')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–û–ø–∏—Å</label>
        <textarea id="description" disabled></textarea>
        <button class="edit-btn" onclick="enableEdit('description')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–î–∞—Ç–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –∫—É—Ä—Å—É</label>
        <input id="dateRange" type="text" disabled />
        <button class="edit-btn" onclick="enableEdit('dateRange')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–¢–∏–ø –≥—Ä—É–ø–∏</label>
        <input id="groupType" type="text" disabled />
        <button class="edit-btn" onclick="enableEdit('groupType')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–¢–∏–ø –¥–æ—Å—Ç—É–ø—É</label>
        <textarea id="access" disabled></textarea>
        <button class="edit-btn" onclick="enableEdit('access')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–£—á–∞—Å–Ω–∏–∫–∏</label>
        <input id="participantsText" type="text" disabled />
        <button class="edit-btn" onclick="openParticipantsModal()">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</label>
        <textarea id="duration" disabled></textarea>
        <button class="edit-btn" onclick="enableEdit('duration')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–¶—ñ–Ω–∞</label>
        <textarea id="price" disabled></textarea>
        <button class="edit-btn" onclick="enableEdit('price')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –∫—É—Ä—Å—É</label>
        <textarea id="zoom" disabled></textarea>
        <button class="edit-btn" onclick="enableEdit('zoom')">
          <img src="../assets/edit-icon.svg" alt="Edit" />
        </button>
      </div>

      <div class="editable-block">
        <label>–í–∏–¥ –∫—É—Ä—Å—É</label>
        <select
          id="eventTypeSel"
          style="
            padding: 12px;
            border: 2px solid #e37009;
            border-radius: 8px;
            background: #fffef9;
            min-height: 48px;
          "
        >
          <option value="–ö—É—Ä—Å">–ö—É—Ä—Å</option>
          <option value="–ì—Ä—É–ø–∞">–ì—Ä—É–ø–∞</option>
          <option value="–°—É–ø–µ—Ä–≤—ñ–∑—ñ—è">–°—É–ø–µ—Ä–≤—ñ–∑—ñ—è</option>
          <option value="–õ–µ–∫—Ü—ñ—è">–õ–µ–∫—Ü—ñ—è</option>
          <option value="–°–µ–º—ñ–Ω–∞—Ä">–°–µ–º—ñ–Ω–∞—Ä</option>
        </select>
      </div>

      <div class="editable-block" id="moderationBlock">
        <label>–ú–æ–¥–µ—Ä–∞—Ü—ñ—è</label>
        <div style="display: flex; gap: 10px; flex-wrap: wrap">
          <button
            type="button"
            class="submit-btn"
            id="approveBtn"
            onclick="approveCourse()"
          >
            ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏
          </button>
          <button
            type="button"
            class="submit-btn"
            id="rejectBtn"
            onclick="rejectCourse()"
            style="background: #a31d1d"
          >
            ‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏
          </button>
          <span
            id="statusHint"
            style="align-self: center; color: #8f8f8f; font-weight: 500"
          ></span>
        </div>
      </div>

      <button class="submit-btn" onclick="saveChanges()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button class="submit-btn danger" id="deleteBtn" onclick="deleteCourse()">
  üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ –∫—É—Ä—Å
</button>
    </div>
    <script src="admin-auth.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (typeof renderAdminSidebar === "function") {
          renderAdminSidebar("admin-career-requests.html");
        }
        if (typeof requireAdminPage === "function") {
          requireAdminPage();
        }
        load();
      });

      let courseId;
      let allUsers = [];
      let selectedParticipantIds = [];

      function pad(n) {
        return String(n).padStart(2, "0");
      }
      function fmtDate(d) {
        if (!d) return "";
        const x = new Date(d);
        if (isNaN(x)) return "";
        return `${pad(x.getDate())}.${pad(
          x.getMonth() + 1
        )}.${x.getFullYear()}`;
      }

      function getFullName(user) {
        return [user.firstName, user.lastName].filter(Boolean).join(" ");
      }

      async function deleteCourse() {
  if (!courseId) return;
  const ok = confirm("–¢–æ—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∫—É—Ä—Å? –î—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.");
  if (!ok) return;

  try {
    const r = await fetch(`http://157.230.121.24:5050/api/courses/${courseId}`, {
      method: "DELETE",
      credentials: "include", // —è–∫—â–æ –±–µ–∫ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∫—É–∫—É –∞–¥–º—ñ–Ω–∞
      headers: { "Content-Type": "application/json" }
    });
    const data = await r.json().catch(() => ({}));
    if (!r.ok) throw new Error(data.message || "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –∫—É—Ä—Å");

    alert("–ö—É—Ä—Å –≤–∏–¥–∞–ª–µ–Ω–æ");
    // –∫—É–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è ‚Äî –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –∑–º—ñ–Ω–∏—Ç–∏
    location.href = "admin-all-courses.html";
  } catch (e) {
    console.error(e);
    alert(e.message || "–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è");
  }
}
      function computeDurationText(startIso, endIso) {
        if (!startIso || !endIso) return "";
        const s = new Date(startIso);
        const e = new Date(endIso);
        if (isNaN(s) || isNaN(e)) return "";
        // normalize to noon to avoid DST issues
        s.setHours(12, 0, 0, 0);
        e.setHours(12, 0, 0, 0);
        const msPerDay = 24 * 60 * 60 * 1000;
        const days = Math.max(0, Math.round((e - s) / msPerDay) + 1); // inclusive range
        const weeks = Math.floor(days / 7);
        const remDays = days % 7;
        const weekPart = weeks ? `${weeks} —Ç–∏–∂–Ω.` : "";
        const dayPart = remDays ? `${remDays} –¥–Ω.` : weeks ? "" : `${days} –¥–Ω.`;
        const joiner = weekPart && dayPart ? " " : "";
        return `${days} –¥–Ω—ñ–≤ (${weekPart}${joiner}${dayPart})`;
      }

      async function loadCourseDetails() {
        const params = new URLSearchParams(window.location.search);
        courseId = params.get("id");
        if (!courseId) return;

        try {
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—É—Ä—Å
          const res = await fetch(
            `http://157.230.121.24:5050/api/courses/${courseId}`
          );
          const course = await res.json();

          document.getElementById("title").value = course.courseTitle;
          document.getElementById("eventType").value = course.eventType;
          document.getElementById("subtitle").value = course.courseSubtitle;
          document.getElementById("description").value =
            course.courseDescription;
          document.getElementById("access").value = course.accessType;
          document.getElementById("duration").value = course.courseDuration;
          document.getElementById("price").value = course.coursePrice;
          document.getElementById("zoom").value = course.zoomLink;
          document.getElementById("creatorName").value =
            course.creatorName || "";
          document.getElementById("creatorRole").value =
            course.creatorRole || "";

          // Fallbacks for creatorName/creatorRole using creatorId if present
          if (
            (!course.creatorName || course.creatorName === "") &&
            course.creatorId
          ) {
            const fallbackName =
              [course.creatorId.firstName, course.creatorId.lastName]
                .filter(Boolean)
                .join(" ") ||
              course.creatorId.email ||
              "";
            document.getElementById("creatorName").value = fallbackName;
          }
          if (
            (!course.creatorRole || course.creatorRole === "") &&
            course.creatorId
          ) {
            const fallbackRole =
              course.creatorId.role ||
              (Array.isArray(course.creatorId.roles)
                ? course.creatorId.roles.join(", ")
                : "");
            document.getElementById("creatorRole").value = fallbackRole;
          }

          selectedParticipantIds = (course.participants || []).map((p) =>
            typeof p === "string" ? p : p && p._id ? p._id : p
          );

          // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
          const usersRes = await fetch("http://157.230.121.24:5050/api/users");
          allUsers = await usersRes.json();

          const start = course.courseDates && course.courseDates.start;
          const end = course.courseDates && course.courseDates.end;

          // –ê–≤—Ç–æ–≤—ã—á–∏—Å–ª–µ–Ω–Ω–∞—è —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∑–∞ –¥–∞—Ç–∞–º–∏
          const autoDuration = computeDurationText(start, end);
          if (autoDuration) {
            const durEl = document.getElementById("duration");
            if (
              durEl &&
              (!durEl.value || durEl.value.trim() === "" || durEl.disabled)
            ) {
              durEl.value = autoDuration;
            }
          }

          const range =
            start || end ? `${fmtDate(start)} ‚Äì ${fmtDate(end)}` : "";
          const group = course.accessType || "";
          document.getElementById("dateRange").value = range;
          document.getElementById("groupType").value = group;

          // –í–∏—Å—Ç–∞–≤–ª—è—î–º–æ "–í–∏–¥ –∫—É—Ä—Å—É" —Å–µ–ª–µ–∫—Ç
          const typeSel = document.getElementById("eventTypeSel");
          if (typeSel && course.eventType) typeSel.value = course.eventType;

          const et = document.getElementById("eventType");
          if (et) et.value = course.eventType || "";

          // –ü—ñ–¥–∫–∞–∑–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É + –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –º–æ–¥–µ—Ä–∞—Ü—ñ—ó
          const mod = document.getElementById("moderationBlock");
          const hint = document.getElementById("statusHint");
          if (hint)
            hint.textContent = course.status
              ? `–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å: ${course.status}`
              : "";
          if (mod) {
            // –Ø–∫—â–æ –≤–∂–µ –Ω–µ –æ—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ, –∞–ª–µ –±–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫–∏
            const isWaiting = course.status === "WAITING_FOR_APPROVAL";
            const approveBtn = document.getElementById("approveBtn");
            const rejectBtn = document.getElementById("rejectBtn");
            if (approveBtn) approveBtn.disabled = !isWaiting;
            if (rejectBtn) rejectBtn.disabled = !isWaiting;
          }

          updateParticipantsUI();
        } catch (err) {
          console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∫—É—Ä—Å—É:", err);
        }
      }

      function updateParticipantsUI() {
        const input = document.getElementById("participantsText");
        if (!input) return;
        const names = allUsers
          .filter((u) => selectedParticipantIds.includes(u._id))
          .map((u) => getFullName(u) || u.email);
        input.value = names.join(", ");
      }

      function enableEdit(id) {
        const textarea = document.getElementById(id);
        textarea.disabled = false;
        textarea.focus();
      }

      async function saveChanges() {
        const updated = {
          courseTitle: document.getElementById("title").value,
          eventType: document.getElementById("eventTypeSel")
            ? document.getElementById("eventTypeSel").value
            : document.getElementById("eventType").value,
          courseSubtitle: document.getElementById("subtitle").value,
          courseDescription: document.getElementById("description").value,
          accessType: document.getElementById("access").value,
          courseDuration: document.getElementById("duration").value,
          coursePrice: document.getElementById("price").value,
          zoomLink: document.getElementById("zoom").value,
          participants: selectedParticipantIds,
        };

        try {
          const res = await fetch(
            `http://157.230.121.24:5050/api/courses/${courseId}`,
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(updated),
            }
          );

          if (res.ok) {
            alert("–î–∞–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ");
            document
              .querySelectorAll("textarea")
              .forEach((t) => (t.disabled = true));
            document
              .querySelectorAll("input[type='text']")
              .forEach((i) => (i.disabled = true));
            // –æ–Ω–æ–≤–∏—Ç–∏ –ø—ñ–¥–∫–∞–∑–∫—É —Å—Ç–∞—Ç—É—Å—É (—Ä–∞–ø—Ç–æ–º –∑–º—ñ–Ω–∏–ª–∞—Å—è –¥–µ—Å—å —â–µ)
            try {
              loadCourseDetails();
            } catch (_) {}
          } else {
            alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ");
          }
        } catch (err) {
          console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ:", err);
        }
      }

      async function approveCourse() {
        if (!courseId) return;
        try {
          const r = await fetch(
            `http://157.230.121.24:5050/api/courses/${courseId}/approve`,
            { method: "PUT" }
          );
          const data = await r.json().catch(() => ({}));
          if (!r.ok)
            throw new Error(data.message || "–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∫—É—Ä—Å");
          alert("–ö—É—Ä—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ");
          loadCourseDetails();
        } catch (e) {
          console.error(e);
          alert(e.message || "–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è");
        }
      }

      async function rejectCourse() {
        if (!courseId) return;
        // –æ–ø—Ü—ñ–π–Ω–æ: –ø–æ–ø—Ä–æ—Å–∏—Ç–∏ –ø—Ä–∏—á–∏–Ω—É
        const reason = prompt("–ü—Ä–∏—á–∏–Ω–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è (–Ω–µ–æ–±–æ–≤ º—è–∑–∫–æ–≤–æ):", "");
        try {
          const r = await fetch(
            `http://157.230.121.24:5050/api/courses/${courseId}/reject`,
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ reason }),
            }
          );
          const data = await r.json().catch(() => ({}));
          if (!r.ok)
            throw new Error(data.message || "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ –∫—É—Ä—Å");
          alert("–ö—É—Ä—Å –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ");
          loadCourseDetails();
        } catch (e) {
          console.error(e);
          alert(e.message || "–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è");
        }
      }

      window.addEventListener("DOMContentLoaded", loadCourseDetails);

      async function openParticipantsModal() {
        try {
          const res = await fetch("http://157.230.121.24:5050/api/users");
          allUsers = await res.json();
          renderUserList(allUsers);
          document.getElementById("participantsModal").style.display = "flex";
        } catch (err) {
          console.error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:", err);
        }
      }

      function renderUserList(users) {
        const container = document.getElementById("userList");
        container.innerHTML = "";
        users.forEach((user) => {
          const div = document.createElement("div");
          const fullName = getFullName(user);
          div.innerHTML = `
      <label>
        <input type="checkbox" value="${user._id}" ${
            selectedParticipantIds.includes(user._id) ? "checked" : ""
          } />
        ${fullName || user.email}
      </label>
    `;
          container.appendChild(div);
        });
      }

      function applySelectedParticipants() {
        const checkboxes = document.querySelectorAll(
          '#userList input[type="checkbox"]'
        );
        selectedParticipantIds = Array.from(checkboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.value);
        updateParticipantsUI();
        closeParticipantsModal();
      }

      function closeParticipantsModal() {
        document.getElementById("participantsModal").style.display = "none";
      }

      function filterParticipants(e) {
        const query = e.target.value.toLowerCase();
        const filtered = allUsers.filter((u) =>
          getFullName(u).toLowerCase().includes(query)
        );
        renderUserList(filtered);
      }
      function logoutUser() {
        try {
          // —á–∏—Å—Ç–∏–º–æ –ª–æ–∫–∞–ª—å–Ω–µ
          localStorage.removeItem("user");
          ["token", "authToken", "jwt", "accessToken", "bearer"].forEach((k) =>
            localStorage.removeItem(k)
          );
        } catch (_) {}

        // –ø—Ä–æ–±—É—î–º–æ –≤–∏–π—Ç–∏ —ñ –Ω–∞ –±–µ–∫–µ–Ω–¥—ñ (—ñ–≥–Ω–æ—Ä—É—î–º–æ –ø–æ–º–∏–ª–∫–∏ –º–µ—Ä–µ–∂—ñ)
        const API = ""; // —è–∫—â–æ –±–µ–∫ —ñ —Ñ—Ä–æ–Ω—Ç –Ω–∞ –æ–¥–Ω–æ–º—É –¥–æ–º–µ–Ω—ñ ‚Äî –∑–∞–ª–∏—à –ø–æ—Ä–æ–∂–Ω—ñ–º
        fetch(`${API}/api/users/logout`, {
          method: "POST",
          credentials: "include",
        }).catch(() => {});

        // —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥—ñ–Ω –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º
        const back = encodeURIComponent(location.pathname + location.search);
        location.href = `admin-login.html?returnUrl=${back}`;
      }

      // –ø—Ä–∏–≤‚Äô—è–∑—É—î–º–æ –¥–æ –∫–Ω–æ–ø–∫–∏
      document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("btnLogout");
        if (btn) btn.addEventListener("click", logoutUser);
      });

      document.addEventListener("DOMContentLoaded", () => {
        const here = location.pathname.split("/").pop();
        document.querySelectorAll(".sidebar nav a").forEach((a) => {
          if (a.getAttribute("href") === here) a.classList.add("active");
        });
      });
    </script>

    <div id="participantsModal" class="modal" style="display: none">
      <div class="modal-content" style="max-height: 70vh; overflow-y: auto">
        <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤</h3>
        <input
          type="text"
          placeholder="–ü–æ—à—É–∫..."
          oninput="filterParticipants(event)"
        />
        <div id="userList" style="margin: 10px 0"></div>
        <button onclick="applySelectedParticipants()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
        <button onclick="closeParticipantsModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      </div>
    </div>
  </body>
</html>
