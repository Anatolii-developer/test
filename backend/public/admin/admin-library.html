<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –∫—É—Ä—Å—ñ–≤</title>
  <link rel="stylesheet" href="admin-styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-overlay {
  position: absolute;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
}

.modal-content {
  position: relative;
  background: #fff;
  border-radius: 16px;
  max-width: 480px;
  width: 90%;
  padding: 32px;
  z-index: 10;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  font-family: 'Poppins', sans-serif;
}

.modal-content h2 {
  margin-top: 0;
  font-size: 22px;
  margin-bottom: 20px;
  text-align: center;
}

.close-btn {
  position: absolute;
  top: 16px;
  right: 20px;
  font-size: 24px;
  cursor: pointer;
  color: #888;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 18px;
}

.form-group label {
  font-weight: 500;
  font-size: 14px;
}

.form-group input,
.form-group textarea,
.form-group select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 14px;
  font-family: 'Poppins', sans-serif;
}

.form-group textarea {
  resize: vertical;
  min-height: 80px;
}

.submit-btn {
  width: 100%;
  background-color: #48a868;
  color: white;
  font-weight: 600;
  font-size: 16px;
  padding: 14px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.submit-btn:hover {
  background-color: #3c9359;
}

  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <img class="logo" src="../assets/sidebar/IPS Logo (2).svg" alt="Logo" id="logoExpanded" />
      <p style="margin-left: 12px; font-weight: 600;">Admin</p>
      <nav>
        <a href="admin-requests.html"><img src="../assets/sidebar/profile.svg" /><span>–ü—Ä–æ—Ñ–∞–π–ª–∏</span></a>
        <a href="admin-certificate.html"><img src="../assets/sidebar/news.svg" /><span>–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</span></a>
        <a href="#"><img src="../assets/sidebar/3.svg" /><span>–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∫–∞—Ä'—î—Ä–∏</span></a>
        <a href="#"><img src="../assets/sidebar/4.svg" /><span>–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞</span></a>
        <a href="admin-all-courses.html"><img src="../assets/sidebar/5.svg" /><span>–ö—É—Ä—Å–∏</span></a>
        <a href="#"><img src="../assets/sidebar/6.svg" /><span>–û–±–ª—ñ–∫ –ø—Ä–∞–∫—Ç–∏–∫–∏</span></a>
        <a href="#"><img src="../assets/sidebar/7.svg" /><span>–ó–¥–æ—Ä–æ–≤‚Äô—è</span></a>
        <a href="#"><img src="../assets/sidebar/8.svg" /><span>–§—ñ–Ω–∞–Ω—Å–∏</span></a>
        <a href="#"><img src="../assets/sidebar/9.svg" /><span>–ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å</span></a>
      </nav>
      <div style="margin-top: auto;">
        <a href="#"><img src="../assets/sidebar/settings.svg" /><span>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span></a>
        <div class="logout" onclick="logoutUser()">
          <img src="../assets/sidebar/log-out.svg" alt="Logout Icon" width="20" height="20" />
          <span>Logout Account</span>
        </div>
      </div>
    </aside>

    <div class="main-content">
      <div class="materials-header">
        <button class="btn-green">–î–æ–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–æ –∫—É—Ä—Å—ñ–≤</button>
        <button class="btn-light-green">–î–æ–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –≥—Ä—É–ø–∏</button>
      </div>

     <div class="filters">
  <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –∑–∞ —ñ–º'—è–º" />

  <select id="roleFilter">
    <option value="">–£—Å—ñ —Ä–æ–ª—ñ</option>
    <option value="–ü—Å–∏—Ö–æ–ª–æ–≥">–ü—Å–∏—Ö–æ–ª–æ–≥</option>
    <option value="–°—É–ø–µ—Ä–≤—ñ–∑–æ—Ä I –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó">–°—É–ø–µ—Ä–≤—ñ–∑–æ—Ä I –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
    <option value="–°—É–ø–µ—Ä–≤—ñ–∑–æ—Ä II –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó">–°—É–ø–µ—Ä–≤—ñ–∑–æ—Ä II –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
  </select>

  <label for="courseSelect">–û–±–µ—Ä—ñ—Ç—å –∫—É—Ä—Å</label>
<select id="courseSelect">
  <option value="">-- –û–±–µ—Ä—ñ—Ç—å –∫—É—Ä—Å --</option>
</select>


  <button id="selectAllBtn" class="btn-light-green">–í–∏–¥—ñ–ª–∏—Ç–∏ –≤—Å—ñ—Ö</button>
</div>

      <table class="participants-table">
        <thead>
          <tr>
            <th>#</th>
            <th>–Ü–º‚Äô—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ</th>
            <th>Email</th>
            <th>–†–æ–ª—å</th>
            <th>–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</th>
            <th>–û–±—Ä–∞—Ç–∏</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="date-time">
        <label>–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ —á–∞—Å –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó</label>
        <input type="date" />
        <input type="time" />
      </div>

      <div class="action-buttons">
        <button class="btn-green-add">–î–æ–¥–∞—Ç–∏ –≤—ñ–¥–µ–æ</button>
        <button class="btn-dark-green">–î–æ–¥–∞—Ç–∏ –∫–Ω–∏–≥—É</button>
      </div>

      <button class="submit-button">Submit</button>
    </div>
  </div>

  <script>
    let allUsers = [];

    function renderTable(users) {
      const tbody = document.querySelector(".participants-table tbody");
      tbody.innerHTML = "";

      users.forEach((user, index) => {
        const fullName = `${user.firstName || ""} ${user.lastName || ""}`;
        const row = document.createElement("tr");
        row.innerHTML = `
  <td>${index + 1}</td>
  <td>${fullName}</td>
  <td>${user.email}</td>
  <td>${user.role || "-"}</td>
  <td>${new Date(user.dateOfBirth).toLocaleDateString("uk-UA")}</td>
  <td>
    <img 
      src="images/checkbox-empty.png" 
      alt="checkbox" 
      class="custom-checkbox" 
      data-role="${user.role}" 
      data-checked="false"
      style="width: 24px; height: 24px; cursor: pointer;" />
  </td>
`;

        tbody.appendChild(row);
      });
    }

    function applyFilters() {
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      const selectedRole = document.getElementById("roleFilter").value;

      const filtered = allUsers.filter(user => {
        const name = `${user.firstName || ""} ${user.lastName || ""}`.toLowerCase();
        const matchName = name.includes(searchValue);
        const matchRole = selectedRole ? user.role === selectedRole : true;
        return matchName && matchRole;
      });

      renderTable(filtered);
    }

    document.addEventListener("DOMContentLoaded", async () => {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫—É—Ä—Å—ñ–≤
  async function loadCurrentCourses() {
    const res = await fetch("http://157.230.121.24:5050/api/courses");
    const allCourses = await res.json();
    const currentCourses = allCourses.filter(c => c.status === "–ü–æ—Ç–æ—á–Ω–∏–π");

    const courseSelect = document.getElementById("courseSelect");
    courseSelect.innerHTML = `<option value="">-- –û–±–µ—Ä—ñ—Ç—å –∫—É—Ä—Å --</option>`;
    currentCourses.forEach(course => {
      const opt = document.createElement("option");
      opt.value = course._id;
      opt.textContent = course.courseTitle;
      courseSelect.appendChild(opt);
    });
  }

  await loadCurrentCourses();

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–≤—Å—ñ approved)
  try {
    const response = await fetch("http://157.230.121.24:5050/api/users/approved");
    allUsers = await response.json();
    renderTable(allUsers);
  } catch (err) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:", err);
  }

  // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ –æ–±—Ä–∞–Ω–æ–º—É –∫—É—Ä—Å—É
  document.getElementById("courseSelect").addEventListener("change", async (e) => {
    const courseId = e.target.value;
    if (!courseId) return;

    try {
      const res = await fetch(`http://157.230.121.24:5050/api/courses/${courseId}/participants`);
      const users = await res.json();
      allUsers = users;
      applyFilters(); // ‚Üê —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    } catch (err) {
      console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —É—á–∞—Å–Ω–∏–∫—ñ–≤ –∫—É—Ä—Å—É:", err);
    }
  });

  document.getElementById("searchInput").addEventListener("input", applyFilters);
  document.getElementById("roleFilter").addEventListener("change", applyFilters);

  document.getElementById("selectAllBtn").addEventListener("click", () => {
    const selectedRole = document.getElementById("roleFilter").value;
    document.querySelectorAll(".custom-checkbox").forEach(cb => {
      const match = !selectedRole || cb.dataset.role === selectedRole;
      cb.src = match ? "images/checkbox.png" : "images/checkbox-empty.png";
      cb.dataset.checked = match.toString();
    });
  });

  document.addEventListener("click", (e) => {
    if (e.target.classList.contains("custom-checkbox")) {
      const checkbox = e.target;
      const isChecked = checkbox.dataset.checked === "true";

      checkbox.src = isChecked ? "images/checkbox-empty.png" : "images/checkbox.png";
      checkbox.dataset.checked = (!isChecked).toString();
    }
  });
});
document.querySelector(".btn-green-add").addEventListener("click", () => {
  openModal("video");
});
document.querySelector(".btn-dark-green").addEventListener("click", () => {
  openModal("book");
});

function openModal(type) {
  document.getElementById("addMaterialModal").style.display = "block";
  document.getElementById("materialType").value = type;
  toggleInputs(type);
}
function closeModal() {
  document.getElementById("addMaterialModal").style.display = "none";
}

document.getElementById("materialType").addEventListener("change", e => {
  toggleInputs(e.target.value);
});

function toggleInputs(type) {
  document.getElementById("videoLink").style.display = type === "video" ? "block" : "none";
  document.getElementById("bookFile").style.display = type === "book" ? "block" : "none";
}

async function submitMaterial() {
  const type = document.getElementById("materialType").value;
  const title = document.getElementById("materialTitle").value;
  const description = document.getElementById("materialDescription").value;

  const formData = new FormData();
  formData.append("type", type);
  formData.append("title", title);
  formData.append("description", description);

  if (type === "video") {
    const link = document.getElementById("videoLink").value;
    formData.append("videoLink", link);
  } else {
    const file = document.getElementById("bookFile").files[0];
    if (!file) return alert("–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª");
    formData.append("bookFile", file);
  }

  try {
    await fetch("http://157.230.121.24:5050/api/library", {
      method: "POST",
      body: formData
    });
    alert("–£—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!");
    closeModal();
    // —Ç—É—Ç –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫
  } catch (err) {
    alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ.");
    console.error(err);
  }
}
function toggleInputs(type) {
  document.getElementById("videoInput").style.display = type === "video" ? "block" : "none";
  document.getElementById("bookInput").style.display = type === "book" ? "block" : "none";
}

    
  </script>
 <div id="addMaterialModal" class="modal" style="display:none;">
  <div class="modal-overlay" onclick="closeModal()"></div>
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">√ó</span>
    <h2>–î–æ–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª</h2>

    <div class="form-group">
      <label for="materialType">–¢–∏–ø –º–∞—Ç–µ—Ä—ñ–∞–ª—É</label>
      <select id="materialType">
        <option value="video">üé• –í—ñ–¥–µ–æ (YouTube)</option>
        <option value="book">üìò –ö–Ω–∏–≥–∞ (PDF)</option>
      </select>
    </div>

    <div class="form-group">
      <label for="materialTitle">–ù–∞–∑–≤–∞</label>
      <input type="text" id="materialTitle" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É" />
    </div>

    <div class="form-group">
      <label for="materialDescription">–û–ø–∏—Å</label>
      <textarea id="materialDescription" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å..."></textarea>
    </div>

    <div class="form-group" id="videoInput" style="display: none;">
      <label for="videoLink">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ YouTube</label>
      <input type="url" id="videoLink" placeholder="https://www.youtube.com/watch?v=..." />
    </div>

    <div class="form-group" id="bookInput" style="display: none;">
      <label for="bookFile">PDF —Ñ–∞–π–ª</label>
      <input type="file" id="bookFile" accept="application/pdf" />
    </div>

    <button class="submit-btn" onclick="submitMaterial()">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
  </div>
</div>

</div>
</body>
</html>
