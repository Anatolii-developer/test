<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: #97c194;
        color: #414141;
        padding: 0;
      }

      main.career-requests-page {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 32px 16px 72px;
        box-sizing: border-box;
      }

      .apply-header {
        width: 100%;
        max-width: 1110px;
        background: #fff;
        border-radius: 24px;
        margin: 0 auto 16px;
        padding: clamp(24px, 4vw, 40px) clamp(24px, 8vw, 100px);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.06);
      }
      .apply-title {
        font-size: clamp(28px, 4vw, 40px);
        font-weight: 600;
        color: #414141;
      }
      .apply-image {
        width: clamp(200px, 28vw, 284px);
        height: auto;
      }
      .apply-arrow {
        width: 56px;
        height: 56px;
        flex-shrink: 0;
      }

      .back-button {
        width: 196px;
        height: 48px;
        background: #275d2b;
        border-radius: 24px;
        color: #fff;
        padding: 10px 53px;
        margin: 0 auto 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        cursor: pointer;
        text-decoration: none;
      }

      .apply-form {
        width: 100%;
        max-width: 1110px;
        background: #fff;
        border-radius: 24px;
        padding: clamp(28px, 5vw, 60px) clamp(24px, 7vw, 100px);
        margin: 0 auto;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.06);
        box-sizing: border-box;
      }

      /* –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ */
      #list {
        margin-top: 10px;
      }

      .req-row {
        width: 100%;
        background: #ffeed9;
        border-radius: 16px;
        padding: 12px 16px;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        gap: 16px;
        margin: 12px 0;
        justify-content: space-between;
      }

      /* –õ–µ–≤–∞—è —á–∞—Å—Ç—å —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è, –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ —Å–∂–∏–º–∞—Ç—å—Å—è */
      .req-left {
        display: flex;
        align-items: center;
        gap: 16px;
        min-width: 0; /* –í–ê–ñ–ù–û: –¥–∞—ë—Ç –ø—Ä–∞–≤–æ –¥–µ—Ç—è–º —Å–∂–∏–º–∞—Ç—å—Å—è */
        flex: 1 1 auto;
      }

      .req-num {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        background: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        flex: 0 0 36px;
      }

      /* –ò–º—è –æ–±—Ä–µ–∑–∞–µ–º –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ–º */
      .req-name {
        font-weight: 500;
        font-size: 20px;
        min-width: 0; /* –í–ê–ñ–ù–û: –∏–Ω–∞—á–µ ellipsis –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç */
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .req-date {
        font-weight: 500;
        font-size: 18px;
        color: #555;
        white-space: nowrap;
        flex: 0 0 auto;
      }

      .btn-more {
        height: 32px;
        padding: 0 16px;
        border-radius: 24px;
        border: none;
        cursor: pointer;
        background: #275d2b;
        color: #fff;
        font-weight: 600;
        font-size: 14px;
        white-space: nowrap;
        flex: 0 0 auto; /* –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è */
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn-more .btn-arrow { display: none; width: 20px; height: 20px; }
      .btn-more .btn-label { display: inline; }

      .empty {
        text-align: center;
        color: #6b6b6b;
        margin-top: 8px;
      }

      @media (max-width: 1024px) {
        main.career-requests-page {
          padding: 20px 12px 60px;
        }
        .apply-header {
          flex-direction: column;
          align-items: center;
          text-align: center;
        }
        .apply-arrow {
          align-self: flex-end;
        }
        .req-row {
          flex-wrap: wrap;
        }
        .req-name {
          max-width: 50vw;
        }
      }

      @media (max-width: 700px) {
        .req-row {
          align-items: flex-start;
        }
        .req-left {
          flex-wrap: wrap;
          gap: 10px;
        }
        .req-name {
          width: 100%;
          order: 3;
          white-space: normal;
          line-height: 1.4;
        }
        .req-date {
          order: 2;
          font-size: 16px;
        }
        .btn-more {
          margin-left: auto;
          width: 48px;
          height: 48px;
          padding: 10px;
          border-radius: 14px;
          background: transparent;
          color: #275d2b;
          box-shadow: none;
        }
        .btn-more .btn-label { display: none; }
        .btn-more .btn-arrow { display: inline-block; }
      }

      /* ==== MODAL (–¥–µ—Ç–∞–ª—ñ –∑–∞—è–≤–∫–∏) ==== */
      .req-modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
      }
      .req-modal {
        width: 720px;
        max-width: 90vw;
        background: #fff;
        border-radius: 16px;
        padding: 24px 24px 20px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
        position: relative;
        max-height: 90vh; /* –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –º–æ–¥–∞–ª–∫–∏ */
        overflow: auto; /* —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ */
        -webkit-overflow-scrolling: touch; /* –ø–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –Ω–∞ iOS */
        overscroll-behavior: contain; /* —á—Ç–æ–±—ã –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª—Å—è —Ñ–æ–Ω –ø—Ä–∏ –¥–æ—Ç—è–≥–∏–≤–∞–Ω–∏–∏ */
      }
      .req-modal h3 {
        margin: 0 0 12px 0;
        font-size: 24px;
        font-weight: 600;
        color: #414141;
      }
      .req-meta {
        color: #6b6b6b;
        font-size: 14px;
        margin-bottom: 12px;
      }
      .req-qa {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 8px;
      }
      .req-qa .row {
        background: #fff7ee;
        border-radius: 12px;
        padding: 12px 14px;
      }
      .req-qa .q {
        font-weight: 600;
        color: #275d2b;
        margin-bottom: 4px;
      }
      .req-qa .a {
        white-space: pre-wrap;
        color: #414141;
      }
      .req-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 16px;
      }
      .req-btn {
        border: none;
        border-radius: 10px;
        padding: 10px 14px;
        cursor: pointer;
        font-weight: 600;
      }
      .req-btn.close {
        background: #f3f4f6;
      }
      .req-btn.primary {
        background: #275d2b;
        color: #fff;
      }
      .req-close-x {
        position: absolute;
        right: 14px;
        top: 12px;
        font-size: 22px;
        line-height: 1;
        cursor: pointer;
        opacity: 0.6;
      }
      .req-close-x:hover {
        opacity: 1;
      }

      .req-tag {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        background: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 16px;
        color: #414141;
        flex: 0 0 36px;
      }
      @media (max-width: 600px) {
        .req-modal {
          max-height: 92vh;
          padding: 18px 16px;
          border-radius: 12px;
        }
        .req-modal h3 {
          font-size: 20px;
        }
      }
    </style>
  </head>
  <body>
  <header class="site-header">
    <button class="burger" id="burgerBtn" aria-label="–í—ñ–¥–∫—Ä–∏—Ç–∏ –º–µ–Ω—é" aria-expanded="false" aria-controls="sidebar">
      <img src="assets/sidebar/burger.svg" alt="" />
    </button>

    <a href="/" class="header-logo" aria-label="–ì–æ–ª–æ–≤–Ω–∞">
      <img src="assets/emblem.svg" alt="IPS" />
    </a>

    <button class="lang-switch" id="langBtn" aria-haspopup="listbox" aria-expanded="false">
      UA ‚ñº
    </button>
  </header>
    <aside class="sidebar collapsed" id="sidebar">
      <div class="toggle-button" onclick="toggleSidebar()">
        <img src="assets/sidebar/arrow.svg" alt="Toggle" id="toggleArrow" />
      </div>
      <img
        class="logo"
        src="assets/sidebar/IPS Logo (2).svg"
        alt="Logo"
        id="logoExpanded"
      />
      <img
        class="logo-collapsed"
        src="assets/sidebar/IPS Logo (1).svg"
        alt="Logo Small"
        id="logoCollapsed"
      />
      <img
        class="profile"
        src="assets/profile-photo.png"
        alt="User"
        width="40"
        height="40"
      />
      <nav>
        <a href="profile.html"
          ><img src="assets/sidebar/profile.svg" /><span>–ü—Ä–æ –ú–µ–Ω–µ</span></a
        >
        <a href="mycertificates.html"
          ><img src="assets/sidebar/news.svg" /><span>–ú–æ—ó –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</span></a
        >
        <a href="career-faq.html"
          ><img src="assets/sidebar/10.svg" /><span>–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –ö–∞—Ä'—î—Ä–∏</span></a
        >
        <a href="library.html"
          ><img src="assets/sidebar/3.svg" /><span>–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞</span></a
        >
        <a href="my-courses.html"
          ><img src="assets/sidebar/5.svg" /><span>–ú–æ—ó –ö—É—Ä—Å–∏</span></a
        >
         <a href="forum/index.html">
  <img src="assets/sidebar/forum.svg" alt="–§–æ—Ä—É–º"/>
  <span>–§–æ—Ä—É–º</span>
</a>
        <a href="practice-records.html"><img src="assets/practice-records.svg" /><span>–û–±–ª—ñ–∫ –ü—Ä–∞–∫—Ç–∏–∫–∏</span></a>
      </nav>
      <div class="logout">
        <img
          src="assets/sidebar/log-out.svg"
          alt="Logout Icon"
          width="20"
          height="20"
        />
        <span>–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É</span>
      </div>
    </aside>
  <div class="drawer-backdrop" id="drawerBackdrop"></div>

    <main class="career-requests-page" id="mainContent">
      <div class="apply-header">
        <div class="apply-title">–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É</div>
        <img class="apply-image" src="./assets/career-apply.png" alt="Person" />
        <img class="apply-arrow" src="./assets/library/arrow.png" alt="Arrow" />
      </div>

      <a href="career-faq.html" class="back-button">
        <img src="./assets/library/arrow-main.svg" alt="Back" /> –ì–æ–ª–æ–≤–Ω–∞
      </a>

      <div class="apply-form">
        <div id="list"></div>
        <div id="empty" class="empty" style="display: none">
          –ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞—è–≤–æ–∫.
        </div>
      </div>
    </main>

    <script>
      const API = "/api/career-applications?mine=1";

      const CAREER_REQUESTS_I18N = {
        ua: {
          title: "–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É",
          applyTitle: "–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É",
          backHome: "–ì–æ–ª–æ–≤–Ω–∞",
          empty: "–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞—è–≤–æ–∫.",
          emptyLogin: "–©–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞—è–≤–∫–∏ ‚Äî —É–≤—ñ–π–¥—ñ—Ç—å —É —Å–∏—Å—Ç–µ–º—É.",
          emptyLoginMine: "–©–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–ª–∞—Å–Ω—ñ –∑–∞—è–≤–∫–∏ ‚Äî —É–≤—ñ–π–¥—ñ—Ç—å —É —Å–∏—Å—Ç–µ–º—É.",
          sessionExpired: "–°–µ–∞–Ω—Å –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è. –ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å —â–µ —Ä–∞–∑.",
          loginBtn: "–£–≤—ñ–π—Ç–∏",
          learnMore: "–î—ñ–∑–Ω–∞—Ç–∏—Å—å –±—ñ–ª—å—à–µ",
          viewApplicationAria: "–í—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞—è–≤–∫—É –¥–µ—Ç–∞–ª—å–Ω–æ",
          modalTitle: "–ó–∞—è–≤–∫–∞",
          modalTitleWithName: "–ó–∞—è–≤–∫–∞ ‚Äî {fio}",
          metaSubmitted: "–î–∞—Ç–∞ –ø–æ–¥–∞–Ω–Ω—è: {date}",
          qName: "–Ü–º º—è",
          qSurname: "–ü—Ä—ñ–∑–≤–∏—â–µ",
          qSubmittedAt: "–î–∞—Ç–∞ –ø–æ–¥–∞–Ω–Ω—è –∑–∞—è–≤–∫–∏",
          qExperience: "–°–∫—ñ–ª—å–∫–∏ —Ä–æ–∫—ñ–≤ —É –≤–∞—Å –ø—Ä–∞–∫—Ç–∏–∫–∏",
          qAge: "–î–æ —è–∫–æ—ó –≤—ñ–∫–æ–≤–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –í–∏ –≤—ñ–¥–Ω–æ—Å–∏—Ç–µ—Å—å",
          qRequest: "–í–∞—à –∑–∞–ø–∏—Ç –¥–æ –º–µ–Ω—Ç–æ—Ä–∞",
          qAbout: "–ü—Ä–æ —Å–µ–±–µ / –¥–µ—Ç–∞–ª—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó",
          qDefault: "–ü–∏—Ç–∞–Ω–Ω—è",
          close: "–ó–∞–∫—Ä–∏—Ç–∏",
          noName: "–ë–µ–∑ —ñ–º–µ–Ω—ñ",
          loadError: "–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–∞—è–≤–∫–∏.",
          tagSupervisor: "–°",
          tagMentor: "–ú",
        },
        ru: {
          title: "–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É",
          applyTitle: "–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É",
          backHome: "–ù–∞ –ì–ª–∞–≤–Ω—É—é",
          empty: "–ü–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç –∑–∞—è–≤–æ–∫.",
          emptyLogin: "–ß—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫–∏ ‚Äî –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.",
          emptyLoginMine: "–ß—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏ ‚Äî –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.",
          sessionExpired: "–°–µ–∞–Ω—Å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –µ—â—ë —Ä–∞–∑.",
          loginBtn: "–í–æ–π—Ç–∏",
          learnMore: "–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ",
          viewApplicationAria: "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫—É",
          modalTitle: "–ó–∞—è–≤–∫–∞",
          modalTitleWithName: "–ó–∞—è–≤–∫–∞ ‚Äî {fio}",
          metaSubmitted: "–î–∞—Ç–∞ –ø–æ–¥–∞—á–∏: {date}",
          qName: "–ò–º—è",
          qSurname: "–§–∞–º–∏–ª–∏—è",
          qSubmittedAt: "–î–∞—Ç–∞ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏",
          qExperience: "–°–∫–æ–ª—å–∫–æ –ª–µ—Ç —É –≤–∞—Å –ø—Ä–∞–∫—Ç–∏–∫–∏",
          qAge: "–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç",
          qRequest: "–í–∞—à –∑–∞–ø—Ä–æ—Å –∫ –º–µ–Ω—Ç–æ—Ä—É",
          qAbout: "–û —Å–µ–±–µ / –¥–µ—Ç–∞–ª–∏ —Å–∏—Ç—É–∞—Ü–∏–∏",
          qDefault: "–í–æ–ø—Ä–æ—Å",
          close: "–ó–∞–∫—Ä—ã—Ç—å",
          noName: "–ë–µ–∑ –∏–º–µ–Ω–∏",
          loadError: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏.",
          tagSupervisor: "–°",
          tagMentor: "–ú",
        },
        en: {
          title: "View Applications",
          applyTitle: "View Applications",
          backHome: "Home",
          empty: "No applications yet.",
          emptyLogin: "To view applications, please log in.",
          emptyLoginMine: "To view your applications, please log in.",
          sessionExpired: "Session expired. Please log in again.",
          loginBtn: "Log in",
          learnMore: "Learn More",
          viewApplicationAria: "View Application",
          modalTitle: "Application",
          modalTitleWithName: "Application ‚Äî {fio}",
          metaSubmitted: "Submitted: {date}",
          qName: "First name",
          qSurname: "Last name",
          qSubmittedAt: "Application date",
          qExperience: "Years of practice",
          qAge: "Age group",
          qRequest: "Request to the mentor",
          qAbout: "About you / details",
          qDefault: "Question",
          close: "Close",
          noName: "No name",
          loadError: "Failed to load applications.",
          tagSupervisor: "S",
          tagMentor: "M",
        },
      };

      let currentLang = "ua";
      const normalizeLang = (value) => {
        const v = String(value || "").toLowerCase().trim();
        if (v.startsWith("uk") || v === "ua") return "ua";
        if (v.startsWith("ru")) return "ru";
        if (v.startsWith("en")) return "en";
        return "ua";
      };
      const getStoredLang = () => {
        try {
          const stored = localStorage.getItem("uiLang");
          if (stored) return normalizeLang(stored);
        } catch (_) {}
        return normalizeLang(document.documentElement.lang);
      };
      const t = (key) => {
        const copy = CAREER_REQUESTS_I18N[currentLang] || CAREER_REQUESTS_I18N.ua;
        return copy[key] || "";
      };
      const template = (str, vars = {}) =>
        String(str || "").replace(/\{(\w+)\}/g, (_, k) =>
          vars[k] !== undefined ? vars[k] : ""
        );

      function setButtonTextWithIcon(el, text) {
        if (!el) return;
        const textNode = Array.from(el.childNodes).find(
          (n) => n.nodeType === Node.TEXT_NODE
        );
        if (textNode) {
          textNode.textContent = ` ${text}`;
        } else {
          el.appendChild(document.createTextNode(` ${text}`));
        }
      }

      function applyLang(lang) {
        currentLang = normalizeLang(lang);
        const copy = CAREER_REQUESTS_I18N[currentLang] || CAREER_REQUESTS_I18N.ua;
        document.title = copy.title;
        const applyTitle = document.querySelector(".apply-title");
        if (applyTitle) applyTitle.textContent = copy.applyTitle;
        const backBtn = document.querySelector(".back-button");
        setButtonTextWithIcon(backBtn, copy.backHome);
        const modalTitle = document.getElementById("reqModalTitle");
        if (modalTitle) modalTitle.textContent = copy.modalTitle;
        const closeBtn = document.getElementById("reqCloseBtn");
        if (closeBtn) closeBtn.textContent = copy.close;
        const emptyEl = document.getElementById("empty");
        if (emptyEl && emptyEl.style.display !== "none" && emptyEl.textContent) {
          emptyEl.textContent = copy.empty;
        }
        document.querySelectorAll(".btn-more .btn-label").forEach((el) => {
          el.textContent = copy.learnMore;
        });
      }

      // Get token from various possible keys
      function getAuthToken() {
        const direct =
          localStorage.getItem("token") ||
          localStorage.getItem("authToken") ||
          localStorage.getItem("jwt") ||
          localStorage.getItem("accessToken") ||
          localStorage.getItem("bearer") ||
          null;

        if (direct) return direct;

        try {
          const u = JSON.parse(localStorage.getItem("user") || "{}");
          return u.token || u.accessToken || null;
        } catch (_) {
          return null;
        }
      }

      function debugLog(prefix, res, body) {
        try {
          console.log(prefix, {
            status: res && res.status,
            ok: res && res.ok,
            url: res && res.url,
            body,
          });
        } catch (e) {}
      }

      // Ensure containers exist even if markup changes
      function ensureContainers() {
        let form = document.querySelector(".apply-form") || document.body;

        let list = document.getElementById("list");
        if (!list) {
          list = document.createElement("div");
          list.id = "list";
          form.appendChild(list);
        }

        let empty = document.getElementById("empty");
        if (!empty) {
          empty = document.createElement("div");
          empty.id = "empty";
          empty.className = "empty";
          empty.style.display = "none";
          empty.textContent = t("empty");
          form.appendChild(empty);
        }
        return { listEl: list, emptyEl: empty };
      }

      // Friendly notice instead of redirect loop
      function showLoginNotice(msg) {
        const { emptyEl, listEl } = ensureContainers();
        emptyEl.textContent = msg || t("emptyLogin");
        emptyEl.style.display = "block";
        if (listEl) listEl.innerHTML = "";
        const btn = document.createElement("a");
        btn.href = "index.html";
        btn.textContent = t("loginBtn");
        btn.style.cssText =
          "display:inline-block;margin-top:8px;background:#275D2B;color:#fff;padding:8px 16px;border-radius:12px;text-decoration:none;";
        emptyEl.appendChild(btn);
      }

      async function ensureAuth() {
        const token = getAuthToken();
        try {
          const res = await fetch("/api/users/profile", {
            method: "GET",
            credentials: "include",
            headers: token ? { Authorization: `Bearer ${token}` } : {},
          });
          let payload = null;
          try {
            payload = await res.clone().json();
          } catch (_) {}
          debugLog("Profile check ‚Üí", res, payload);
          if (res.ok) return payload;
          return null;
        } catch (e) {
          console.warn("ensureAuth failed:", e);
          return null;
        }
      }

      const pad = (n) => String(n).padStart(2, "0");
      function formatDate(iso) {
        const d = new Date(iso);
        if (isNaN(d)) return "";
        return `${pad(d.getDate())}-${pad(
          d.getMonth() + 1
        )}-${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
      }

      function rowTemplate(i, item) {
        const fullName =
          (item.user &&
            `${item.user.firstName || ""} ${
              item.user.lastName || ""
            }`.trim()) ||
          (item.fullName && item.fullName.trim()) ||
          (item.email || "").trim() ||
          t("noName");

        const created = item.createdAt
          ? formatDate(item.createdAt)
          : item.created_at
          ? formatDate(item.created_at)
          : "";

        // –ù–û–í–û–ï: –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–¥—Ä–µ—Å–∞—Ç–∞ (–±—ç–∫–µ–Ω–¥ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç target –∏–ª–∏ targetType)
        const targetCode = (item.target || item.targetType || "")
          .toString()
          .toLowerCase();
        // –ë—É–∫–≤–∞: –° ‚Äî —Å—É–ø–µ—Ä–≤—ñ–∑–æ—Ä, –ú ‚Äî –º–µ–Ω—Ç–æ—Ä (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
        const tagLetter = targetCode.startsWith("sup")
          ? t("tagSupervisor")
          : t("tagMentor");

        const row = document.createElement("div");
        row.className = "req-row";

        const left = document.createElement("div");
        left.className = "req-left";

        const num = document.createElement("div");
        num.className = "req-num";
        num.textContent = i;

        const name = document.createElement("div");
        name.className = "req-name";
        name.textContent = fullName;

        const date = document.createElement("div");
        date.className = "req-date";
        date.textContent = created;

        // üëá –ù–û–í–û–ï: –±–µ–π–¥–∂ ¬´–°/–ú¬ª
        const tag = document.createElement("div");
        tag.className = "req-tag";
        tag.textContent = tagLetter;

        left.append(num, name, date, tag);

        const more = document.createElement("button");
        more.className = "btn-more";
        more.setAttribute("aria-label", t("viewApplicationAria"));
        more.innerHTML = `
          <span class="btn-label">${t("learnMore")}</span>
          <img src="./assets/library/arrow.png" alt="Arrow" class="btn-arrow" />
        `;
        more.addEventListener("click", () => openReqModal(item));

        row.append(left, more);
        return row;
      }

      async function load() {
        const { listEl, emptyEl } = ensureContainers();

        try {
          const user = await ensureAuth();
          if (!user) {
            showLoginNotice(t("emptyLoginMine"));
            return;
          }

          const token = getAuthToken();
          const res = await fetch(API, {
            method: "GET",
            headers: Object.assign(
              { Accept: "application/json" },
              token ? { Authorization: `Bearer ${token}` } : {}
            ),
            credentials: "include",
          });

          let data = null;
          try {
            data = await res.clone().json();
          } catch (_) {}
          debugLog("Career apps ‚Üí", res, data);

          if (
            res.status === 401 ||
            (data &&
              data.ok === false &&
              /unauthorized/i.test(data.message || ""))
          ) {
            showLoginNotice(t("sessionExpired"));
            return;
          }

          const items = Array.isArray(data)
            ? data
            : Array.isArray(data?.rows)
            ? data.rows
            : Array.isArray(data?.items)
            ? data.items
            : Array.isArray(data?.data)
            ? data.data
            : data?.ok && Array.isArray(data?.result)
            ? data.result
            : [];

          listEl.innerHTML = "";

          if (!items.length) {
            emptyEl.style.display = "block";
            emptyEl.textContent = t("empty");
            return;
          }

          emptyEl.style.display = "none";

          items
            .sort(
              (a, b) =>
                new Date(b.createdAt || b.created_at || 0) -
                new Date(a.createdAt || a.created_at || 0)
            )
            .forEach((it, idx) => listEl.appendChild(rowTemplate(idx + 1, it)));
        } catch (err) {
          console.error("Career applications load failed:", err);
          const { emptyEl } = ensureContainers();
          emptyEl.textContent = t("loadError");
          emptyEl.style.display = "block";
        }
      }

      // Run after DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        applyLang(getStoredLang());
      });
      document.addEventListener("DOMContentLoaded", load);

      window.addEventListener("uiLangChange", (e) => {
        applyLang(e.detail?.lang);
        load();
      });

      function esc(s = "") {
        return String(s).replace(
          /[&<>"']/g,
          (m) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#039;",
            }[m])
        );
      }
      function fullNameFrom(item) {
        // –∏–º—è/—Ñ–∞–º–∏–ª–∏—è
        const u = item.user || {};
        const first = u.firstName || item.firstName || "";
        const last = u.lastName || item.lastName || "";
        return first || last
          ? `${first} ${last}`.trim()
          : item.fullName || item.email || t("noName");
      }

      function getReqEls() {
        return {
          modal: document.getElementById("reqModal"),
          title: document.getElementById("reqModalTitle"),
          meta: document.getElementById("reqMeta"),
          qa: document.getElementById("reqQA"),
          closeX: document.getElementById("reqCloseX"),
          closeBtn: document.getElementById("reqCloseBtn"),
        };
      }

      function bindReqModalEvents() {
        const { modal, closeX, closeBtn } = getReqEls();
        if (!modal || window.__reqModalBound) return;
        if (closeX) closeX.addEventListener("click", closeReqModal);
        if (closeBtn) closeBtn.addEventListener("click", closeReqModal);
        modal.addEventListener("click", (e) => {
          if (e.target === modal) closeReqModal();
        });
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closeReqModal();
        });
        window.__reqModalBound = true;
      }

      function openReqModal(item) {
        bindReqModalEvents();
        const { modal, title, meta, qa } = getReqEls();
        if (!modal || !title || !meta || !qa) return;

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –º–µ—Ç–∞
        const fio = fullNameFrom(item);
        const when = item.createdAt || item.created_at || item.created || null;
        const whenStr = when ? formatDate(when) : "";
        title.textContent = template(t("modalTitleWithName"), { fio });
        meta.textContent = whenStr
          ? template(t("metaSubmitted"), { date: whenStr })
          : "";

        // Q&A –±–ª–æ–∫
        qa.innerHTML = "";

        const rows = [
          {
            q: t("qName"),
            a: (item.user?.firstName || item.firstName || "").trim(),
          },
          {
            q: t("qSurname"),
            a: (item.user?.lastName || item.lastName || "").trim(),
          },
          { q: t("qSubmittedAt"), a: whenStr },
          {
            q: t("qExperience"),
            a: item.experience || item.exp || "",
          },
          {
            q: t("qAge"),
            a: item.ageGroup || item.age || "",
          },
          {
            q: t("qRequest"),
            a: item.requestText || item.request || "",
          },
          {
            q: t("qAbout"),
            a: item.aboutText || item.about || "",
          },
        ];

        if (Array.isArray(item.answers)) {
          item.answers.forEach((x) => {
            rows.push({ q: x.question || t("qDefault"), a: x.answer || "" });
          });
        }

        rows
          .filter((r) => r.a && String(r.a).trim().length)
          .forEach((r) => {
            const row = document.createElement("div");
            row.className = "row";
            row.innerHTML = `
        <div class="q">${esc(r.q)}</div>
        <div class="a">${esc(String(r.a))}</div>
      `;
            qa.appendChild(row);
          });

        // –ø–æ–∫–∞–∑–∞—Ç–∏
        modal.style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeReqModal() {
        const { modal } = getReqEls();
        if (modal) {
          modal.style.display = "none";
          document.body.style.overflow = "";
        }
      }

      // —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è —Å–≤—è–∂—É—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∫–ª–∏–∫ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—á–µ–Ω—å —Ä–∞–Ω–æ)
      document.addEventListener("DOMContentLoaded", bindReqModalEvents);
    </script>

    <script src="script.js"></script>

    <!-- MODAL: –¥–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ -->
    <div
      id="reqModal"
      class="req-modal-backdrop"
      role="dialog"
      aria-modal="true"
      aria-labelledby="reqModalTitle"
    >
      <div class="req-modal">
        <div class="req-close-x" id="reqCloseX">√ó</div>
        <h3 id="reqModalTitle">–ó–∞—è–≤–∫–∞</h3>
        <div class="req-meta" id="reqMeta"></div>
        <div class="req-qa" id="reqQA"></div>
        <div class="req-actions">
          <button class="req-btn close" id="reqCloseBtn">–ó–∞–∫—Ä–∏—Ç–∏</button>
          <!-- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å —Å—é–¥–∞ primary-–∫–Ω–æ–ø–∫—É -->
        </div>
      </div>
    </div>
  </body>
</html>
